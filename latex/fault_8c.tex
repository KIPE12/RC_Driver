\doxysection{C:\+/\+\+Users/\+\+USER/\+\+One\+Drive/\+\+Desktop/\+doxygen/\+\+RC\+\_\+\+DRIVER/\+fault.c 파일 참조}
\hypertarget{fault_8c}{}\label{fault_8c}\index{C:/Users/USER/OneDrive/Desktop/doxygen/RC\_DRIVER/fault.c@{C:/Users/USER/OneDrive/Desktop/doxygen/RC\_DRIVER/fault.c}}


인버터 고장 감지 및 처리 모듈  


{\ttfamily \+\#include "{}inv.\+h"{}}\newline
{\ttfamily \+\#include "{}control.\+h"{}}\newline
{\ttfamily \+\#include "{}fault.\+h"{}}\newline
{\ttfamily \+\#include "{}flag.\+h"{}}\newline
fault.\+c에 대한 include 의존 그래프
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=307pt]{fault_8c__incl}
\end{center}
\end{figure}
\doxysubsubsection*{함수}
\begin{DoxyCompactItemize}
\item 
void \doxymbox{\hyperlink{fault_8c_a0cd91fd3a9608559c2a87a8ba6cba55f}{HAL\+\_\+\+GPIO\+\_\+\+EXTI\+\_\+\+Callback}} (uint16\+\_\+t GPIO\+\_\+\+Pin)
\begin{DoxyCompactList}\small\item\em GPIO 외부 인터럽트 콜백 (하드웨어 고장 진입점) \end{DoxyCompactList}\item 
void \doxymbox{\hyperlink{fault_8c_a9e792a029e400717c2f3bde3b10624dc}{Hard\+Ware\+Fault}} (void)
\begin{DoxyCompactList}\small\item\em 하드웨어 고장 처리 함수 \end{DoxyCompactList}\item 
void \doxymbox{\hyperlink{fault_8c_a5d0d662228c78364b02259814f0f8ccd}{Soft\+Ware\+Fault}} (void)
\begin{DoxyCompactList}\small\item\em 소프트웨어 고장 처리 함수 \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{변수}
\begin{DoxyCompactItemize}
\item 
uint16\+\_\+t \doxymbox{\hyperlink{fault_8c_a50f1eedc97a8c9a5d888c594de881110}{Fault\+Cnt}} = 0
\begin{DoxyCompactList}\small\item\em 누적 고장 발생 횟수 (HW + SW 합산) \end{DoxyCompactList}\item 
struct FAULT\+\_\+\+VAL \doxymbox{\hyperlink{fault_8c_a49db91e8e4ea0a7c53b48c9602abe155}{FLTVAL}}
\begin{DoxyCompactList}\small\item\em 고장 발생 시점의 전기적 상태 스냅샷 \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{상세한 설명}
인버터 고장 감지 및 처리 모듈 

하드웨어 고장(\+GPIO EXTI)과 소프트웨어 고장(과전류 등)을 감지하여 PWM을 즉시 차단하고 고장 발생 시점의 상태를 FLTVAL에 저장한다.

고장 종류 및 FLAG.\+FAULT 값:\+ 
\begin{DoxyTable}{3}{}{}{1}
\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}값  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}종류  &\SetCell{c,bg=\tableheadbgcolor,font=\bfseries}트리거  \\
0  &정상  &-\/  \\
1  &하드웨어 고장  &GPIO EXTI (OCP, OVP 등 외부 회로)  \\
\end{DoxyTable}
\texorpdfstring{$\vert$}{|} 2 \texorpdfstring{$\vert$}{|} 소프트웨어 고장 \texorpdfstring{$\vert$}{|} 전류 임계값 초과 (\texorpdfstring{$\vert$}{|}\+I\texorpdfstring{$\vert$}{|} ≥ 80A) \texorpdfstring{$\vert$}{|}

\begin{DoxyNote}{주의}
하드웨어 고장(1)이 발생한 후에는 소프트웨어 고장(2)이 덮어쓰지 않는다. (우선순위:\+ 하드웨어 \texorpdfstring{$>$}{>} 소프트웨어)
\end{DoxyNote}
\begin{DoxyAuthor}{작성자}
HALAB\+\_\+G 
\end{DoxyAuthor}
\begin{DoxyDate}{날짜}
2024-\/12-\/06 
\end{DoxyDate}


\doxymbox{\hyperlink{fault_8c_source}{fault.\+c}} 파일에서 정의되었습니다.



\label{doc-func-members}
\Hypertarget{fault_8c_doc-func-members}
\doxysubsection{함수 문서화}
\Hypertarget{fault_8c_a0cd91fd3a9608559c2a87a8ba6cba55f}\index{fault.c@{fault.c}!HAL\_GPIO\_EXTI\_Callback@{HAL\_GPIO\_EXTI\_Callback}}
\index{HAL\_GPIO\_EXTI\_Callback@{HAL\_GPIO\_EXTI\_Callback}!fault.c@{fault.c}}
\doxysubsubsection{\texorpdfstring{HAL\_GPIO\_EXTI\_Callback()}{HAL\_GPIO\_EXTI\_Callback()}}
{\footnotesize\ttfamily \label{fault_8c_a0cd91fd3a9608559c2a87a8ba6cba55f} 
void HAL\+\_\+\+GPIO\+\_\+\+EXTI\+\_\+\+Callback (\begin{DoxyParamCaption}\item[{uint16\+\_\+t}]{GPIO\+\_\+\+Pin}{}\end{DoxyParamCaption})}



GPIO 외부 인터럽트 콜백 (하드웨어 고장 진입점) 

DRV8300 OCP, 과전압 보호 등 하드웨어 보호 회로가 EXTI를 발생시킬 때 호출된다. 인터럽트 발생 즉시 PWM을 차단한 후 \doxylink{fault_8c_a9e792a029e400717c2f3bde3b10624dc}{Hard\+Ware\+Fault()}를 호출한다.


\begin{DoxyParams}[1]{매개변수}
\doxymbox{\texttt{in}}  & {\em GPIO\+\_\+\+Pin} & 트리거된 GPIO 핀 마스크 (stm32g4xx\+\_\+it.\+c에서 전달) \\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{반환값}
{\em None} & \\
\hline
\end{DoxyRetVals}


\doxymbox{\hyperlink{fault_8c_source}{fault.\+c}} 파일의 \doxymbox{\hyperlink{fault_8c_source_l00039}{39}} 번째 라인에서 정의되었습니다.


\begin{DoxyCode}{0}
\DoxyCodeLine{00040\ \{}
\DoxyCodeLine{00041\ \ \ \ \ \doxymbox{\hyperlink{inv_8c_a9013a288bba48367bf9d57702c80b1ee}{PwmSwOff}}();}
\DoxyCodeLine{00042\ \ \ \ \ \doxymbox{\hyperlink{fault_8c_a9e792a029e400717c2f3bde3b10624dc}{HardWareFault}}();}
\DoxyCodeLine{00043\ \}}

\end{DoxyCode}
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.:\+
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{fault_8c_a0cd91fd3a9608559c2a87a8ba6cba55f_cgraph}
\end{center}
\end{figure}
\Hypertarget{fault_8c_a9e792a029e400717c2f3bde3b10624dc}\index{fault.c@{fault.c}!HardWareFault@{HardWareFault}}
\index{HardWareFault@{HardWareFault}!fault.c@{fault.c}}
\doxysubsubsection{\texorpdfstring{HardWareFault()}{HardWareFault()}}
{\footnotesize\ttfamily \label{fault_8c_a9e792a029e400717c2f3bde3b10624dc} 
void Hard\+Ware\+Fault (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}



하드웨어 고장 처리 함수 

외부 보호 회로(\+EXTI)에 의해 트리거된 고장을 처리한다. FLAG.\+FAULT = 1로 설정하고 고장 시점의 전기량을 FLTVAL에 저장한다.

저장 항목:\+
\begin{DoxyItemize}
\item FLTVAL.\+Vdc :\+ DC 링크 전압 \+[V]\+
\item FLTVAL.\+Idc :\+ DC 링크 전류 \+[A]\+
\item FLTVAL.\+Ia/\+\+Ib/\+\+Ic :\+ 3상 전류 \+[A]\+
\item FLTVAL.\+Wrpm :\+ 추정 속도 \+[rpm]\+
\end{DoxyItemize}


\begin{DoxyRetVals}{반환값}
{\em None} & \\
\hline
\end{DoxyRetVals}


\doxymbox{\hyperlink{fault_8c_source}{fault.\+c}} 파일의 \doxymbox{\hyperlink{fault_8c_source_l00059}{59}} 번째 라인에서 정의되었습니다.


\begin{DoxyCode}{0}
\DoxyCodeLine{00060\ \{}
\DoxyCodeLine{00061\ \ \ \ \ \doxymbox{\hyperlink{inv_8c_a9013a288bba48367bf9d57702c80b1ee}{PwmSwOff}}();}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \ \ \doxymbox{\hyperlink{flag_8c_ac09613eff9a28b2750787c13d7d6fdc9}{FLAG}}.FAULT\ =\ 1;}
\DoxyCodeLine{00064\ \ \ \ \ \doxymbox{\hyperlink{flag_8c_ac09613eff9a28b2750787c13d7d6fdc9}{FLAG}}.READY\ =\ 0;}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \ \ \doxymbox{\hyperlink{fault_8c_a49db91e8e4ea0a7c53b48c9602abe155}{FLTVAL}}.Vdc\ \ =\ \doxymbox{\hyperlink{inv_8c_a5b799dff3aee9e48ae67cfe1f9075e30}{INV}}.Vdc;}
\DoxyCodeLine{00067\ \ \ \ \ \doxymbox{\hyperlink{fault_8c_a49db91e8e4ea0a7c53b48c9602abe155}{FLTVAL}}.Idc\ \ =\ \doxymbox{\hyperlink{inv_8c_a5b799dff3aee9e48ae67cfe1f9075e30}{INV}}.Idc;}
\DoxyCodeLine{00068\ \ \ \ \ \doxymbox{\hyperlink{fault_8c_a49db91e8e4ea0a7c53b48c9602abe155}{FLTVAL}}.Ia\ \ \ =\ \doxymbox{\hyperlink{inv_8c_a5b799dff3aee9e48ae67cfe1f9075e30}{INV}}.Ia;}
\DoxyCodeLine{00069\ \ \ \ \ \doxymbox{\hyperlink{fault_8c_a49db91e8e4ea0a7c53b48c9602abe155}{FLTVAL}}.Ib\ \ \ =\ \doxymbox{\hyperlink{inv_8c_a5b799dff3aee9e48ae67cfe1f9075e30}{INV}}.Ib;}
\DoxyCodeLine{00070\ \ \ \ \ \doxymbox{\hyperlink{fault_8c_a49db91e8e4ea0a7c53b48c9602abe155}{FLTVAL}}.Ic\ \ \ =\ \doxymbox{\hyperlink{inv_8c_a5b799dff3aee9e48ae67cfe1f9075e30}{INV}}.Ic;}
\DoxyCodeLine{00071\ \ \ \ \ \doxymbox{\hyperlink{fault_8c_a49db91e8e4ea0a7c53b48c9602abe155}{FLTVAL}}.Wrpm\ =\ \doxymbox{\hyperlink{inv_8c_a5b799dff3aee9e48ae67cfe1f9075e30}{INV}}.Wrpm;}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \ \ \doxymbox{\hyperlink{fault_8c_a50f1eedc97a8c9a5d888c594de881110}{FaultCnt}}++;}
\DoxyCodeLine{00074\ \}}

\end{DoxyCode}
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.:\+
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=263pt]{fault_8c_a9e792a029e400717c2f3bde3b10624dc_cgraph}
\end{center}
\end{figure}
이 함수를 호출하는 함수들에 대한 그래프입니다.:\+
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=334pt]{fault_8c_a9e792a029e400717c2f3bde3b10624dc_icgraph}
\end{center}
\end{figure}
\Hypertarget{fault_8c_a5d0d662228c78364b02259814f0f8ccd}\index{fault.c@{fault.c}!SoftWareFault@{SoftWareFault}}
\index{SoftWareFault@{SoftWareFault}!fault.c@{fault.c}}
\doxysubsubsection{\texorpdfstring{SoftWareFault()}{SoftWareFault()}}
{\footnotesize\ttfamily \label{fault_8c_a5d0d662228c78364b02259814f0f8ccd} 
void Soft\+Ware\+Fault (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}



소프트웨어 고장 처리 함수 

제어 소프트웨어 내에서 감지된 고장(과전류 등)을 처리한다. FLAG.\+FAULT == 1 (하드웨어 고장)이 이미 발생한 경우에는 덮어쓰지 않는다.

호출 조건 (\doxylink{control_8c}{control.\+c} 내):\+ 
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keywordflow}{if}\ (ABS(\doxymbox{\hyperlink{inv_8c_a5b799dff3aee9e48ae67cfe1f9075e30}{INV}}.Ia)\ >=\ 80.f)\ \doxymbox{\hyperlink{fault_8c_a5d0d662228c78364b02259814f0f8ccd}{SoftWareFault}}();}

\end{DoxyCode}


\begin{DoxyNote}{주의}
하드웨어 고장 우선 원칙:\+ FLAG.\+FAULT != 1 인 경우에만 FLAG.\+FAULT = 2로 설정한다.
\end{DoxyNote}

\begin{DoxyRetVals}{반환값}
{\em None} & \\
\hline
\end{DoxyRetVals}


\doxymbox{\hyperlink{fault_8c_source}{fault.\+c}} 파일의 \doxymbox{\hyperlink{fault_8c_source_l00092}{92}} 번째 라인에서 정의되었습니다.


\begin{DoxyCode}{0}
\DoxyCodeLine{00093\ \{}
\DoxyCodeLine{00094\ \ \ \ \ \doxymbox{\hyperlink{inv_8c_a9013a288bba48367bf9d57702c80b1ee}{PwmSwOff}}();}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \ \ \ \ \doxymbox{\hyperlink{flag_8c_ac09613eff9a28b2750787c13d7d6fdc9}{FLAG}}.READY\ =\ 0;}
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{keywordflow}{if}\ (\doxymbox{\hyperlink{flag_8c_ac09613eff9a28b2750787c13d7d6fdc9}{FLAG}}.FAULT\ !=\ 1)\ \doxymbox{\hyperlink{flag_8c_ac09613eff9a28b2750787c13d7d6fdc9}{FLAG}}.FAULT\ =\ 2;\ \textcolor{comment}{/*\ 하드웨어\ 고장\ 우선\ */}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \ \ \ \ \doxymbox{\hyperlink{fault_8c_a49db91e8e4ea0a7c53b48c9602abe155}{FLTVAL}}.Vdc\ \ =\ \doxymbox{\hyperlink{inv_8c_a5b799dff3aee9e48ae67cfe1f9075e30}{INV}}.Vdc;}
\DoxyCodeLine{00100\ \ \ \ \ \doxymbox{\hyperlink{fault_8c_a49db91e8e4ea0a7c53b48c9602abe155}{FLTVAL}}.Idc\ \ =\ \doxymbox{\hyperlink{inv_8c_a5b799dff3aee9e48ae67cfe1f9075e30}{INV}}.Idc;}
\DoxyCodeLine{00101\ \ \ \ \ \doxymbox{\hyperlink{fault_8c_a49db91e8e4ea0a7c53b48c9602abe155}{FLTVAL}}.Ia\ \ \ =\ \doxymbox{\hyperlink{inv_8c_a5b799dff3aee9e48ae67cfe1f9075e30}{INV}}.Ia;}
\DoxyCodeLine{00102\ \ \ \ \ \doxymbox{\hyperlink{fault_8c_a49db91e8e4ea0a7c53b48c9602abe155}{FLTVAL}}.Ib\ \ \ =\ \doxymbox{\hyperlink{inv_8c_a5b799dff3aee9e48ae67cfe1f9075e30}{INV}}.Ib;}
\DoxyCodeLine{00103\ \ \ \ \ \doxymbox{\hyperlink{fault_8c_a49db91e8e4ea0a7c53b48c9602abe155}{FLTVAL}}.Ic\ \ \ =\ \doxymbox{\hyperlink{inv_8c_a5b799dff3aee9e48ae67cfe1f9075e30}{INV}}.Ic;}
\DoxyCodeLine{00104\ \ \ \ \ \doxymbox{\hyperlink{fault_8c_a49db91e8e4ea0a7c53b48c9602abe155}{FLTVAL}}.Wrpm\ =\ \doxymbox{\hyperlink{inv_8c_a5b799dff3aee9e48ae67cfe1f9075e30}{INV}}.Wrpm;}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ \ \ \doxymbox{\hyperlink{fault_8c_a50f1eedc97a8c9a5d888c594de881110}{FaultCnt}}++;}
\DoxyCodeLine{00107\ \}}

\end{DoxyCode}
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.:\+
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=260pt]{fault_8c_a5d0d662228c78364b02259814f0f8ccd_cgraph}
\end{center}
\end{figure}
이 함수를 호출하는 함수들에 대한 그래프입니다.:\+
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{fault_8c_a5d0d662228c78364b02259814f0f8ccd_icgraph}
\end{center}
\end{figure}


\label{doc-var-members}
\Hypertarget{fault_8c_doc-var-members}
\doxysubsection{변수 문서화}
\Hypertarget{fault_8c_a50f1eedc97a8c9a5d888c594de881110}\index{fault.c@{fault.c}!FaultCnt@{FaultCnt}}
\index{FaultCnt@{FaultCnt}!fault.c@{fault.c}}
\doxysubsubsection{\texorpdfstring{FaultCnt}{FaultCnt}}
{\footnotesize\ttfamily \label{fault_8c_a50f1eedc97a8c9a5d888c594de881110} 
uint16\+\_\+t Fault\+Cnt = 0}



누적 고장 발생 횟수 (HW + SW 합산) 



\doxymbox{\hyperlink{fault_8c_source}{fault.\+c}} 파일의 \doxymbox{\hyperlink{fault_8c_source_l00027}{27}} 번째 라인에서 정의되었습니다.

\Hypertarget{fault_8c_a49db91e8e4ea0a7c53b48c9602abe155}\index{fault.c@{fault.c}!FLTVAL@{FLTVAL}}
\index{FLTVAL@{FLTVAL}!fault.c@{fault.c}}
\doxysubsubsection{\texorpdfstring{FLTVAL}{FLTVAL}}
{\footnotesize\ttfamily \label{fault_8c_a49db91e8e4ea0a7c53b48c9602abe155} 
struct FAULT\+\_\+\+VAL FLTVAL}



고장 발생 시점의 전기적 상태 스냅샷 



\doxymbox{\hyperlink{fault_8c_source}{fault.\+c}} 파일의 \doxymbox{\hyperlink{fault_8c_source_l00028}{28}} 번째 라인에서 정의되었습니다.

