<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ko">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.16.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RC_Driver: C:/Users/USER/OneDrive/Desktop/doxygen/RC_DRIVER/inv.c 파일 참조</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">RC_Driver<span id="projectnumber">&#160;1.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 다음에 의해 생성됨 :  Doxygen 1.16.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','검색',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('inv_8c.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">로딩중...</div>
<div class="SRStatus" id="Searching">검색중...</div>
<div class="SRStatus" id="NoMatches">일치하는것 없음</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">inv.c 파일 참조</div></div>
</div><!--header-->
<div class="contents">

<p>인버터 제어 핵심 알고리즘 모듈  
<a href="#details">더 자세히 ...</a></p>
<div class="textblock"><code>#include &quot;inv.h&quot;</code><br />
<code>#include &quot;flag.h&quot;</code><br />
<code>#include &quot;variable.h&quot;</code><br />
<code>#include &quot;speed_observer.h&quot;</code><br />
<code>#include &quot;math.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
inv.c에 대한 include 의존 그래프</div>
<div class="dyncontent">
<div class="center"><img src="inv_8c__incl.png" border="0" usemap="#a_c_1_2_users_2_u_s_e_r_2_one_drive_2_desktop_2doxygen_2_r_c___d_r_i_v_e_r_2inv_8c" loading="lazy" alt=""/></div>
<map name="a_c_1_2_users_2_u_s_e_r_2_one_drive_2_desktop_2doxygen_2_r_c___d_r_i_v_e_r_2inv_8c" id="a_c_1_2_users_2_u_s_e_r_2_one_drive_2_desktop_2doxygen_2_r_c___d_r_i_v_e_r_2inv_8c">
<area shape="rect" title="인버터 제어 핵심 알고리즘 모듈" alt="" coords="73,5,314,48"/>
<area shape="rect" title=" " alt="" coords="5,96,54,123"/>
<area shape="poly" title=" " alt="" coords="152,51,69,92,67,87,150,46"/>
<area shape="rect" title=" " alt="" coords="78,96,131,123"/>
<area shape="poly" title=" " alt="" coords="173,48,131,87,128,83,168,50"/>
<area shape="rect" title=" " alt="" coords="155,96,232,123"/>
<area shape="poly" title=" " alt="" coords="195,47,196,82,191,79,192,51"/>
<area shape="rect" title=" " alt="" coords="257,96,381,123"/>
<area shape="poly" title=" " alt="" coords="227,46,289,87,284,87,225,51"/>
<area shape="rect" title=" " alt="" coords="406,96,467,123"/>
<area shape="poly" title=" " alt="" coords="256,46,393,92,388,94,256,51"/>
</map>
</div>
</div>
<p><a href="inv_8c_source.html">이 파일의 소스 코드 페이지로 가기</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
함수</h2></td></tr>
<tr class="memitem:a917cf2e97121d1990d40ef50799f3ecd" id="r_a917cf2e97121d1990d40ef50799f3ecd"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#a917cf2e97121d1990d40ef50799f3ecd">InitParameter</a> (struct INVERTER *<a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>, float Rs, float Ld, float Lq, float Lamf, float PP, float Jm, float Bm, float Idsr_align, float Is_rated, float Is_limit, float Wrpm_rated, float Te_rated)</td></tr>
<tr class="memdesc:a917cf2e97121d1990d40ef50799f3ecd"><td class="mdescLeft">&#160;</td><td class="mdescRight">전동기 및 인버터 기본 파라미터를 초기화한다.  <br /></td></tr>
<tr class="memitem:a643273242fd423931f39716c68ac91bf" id="r_a643273242fd423931f39716c68ac91bf"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#a643273242fd423931f39716c68ac91bf">InitCurrentController</a> (struct INVERTER *<a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>, float Wcc)</td></tr>
<tr class="memdesc:a643273242fd423931f39716c68ac91bf"><td class="mdescLeft">&#160;</td><td class="mdescRight">전류 제어기를 초기화하고 관련 상태 변수를 0으로 리셋한다.  <br /></td></tr>
<tr class="memitem:a0e276774794e294c9ba7a8ec91266d75" id="r_a0e276774794e294c9ba7a8ec91266d75"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#a0e276774794e294c9ba7a8ec91266d75">InitSpeedController</a> (struct INVERTER *<a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>, float Wsc, float zeta)</td></tr>
<tr class="memdesc:a0e276774794e294c9ba7a8ec91266d75"><td class="mdescLeft">&#160;</td><td class="mdescRight">속도 제어기를 초기화하고 관련 상태 변수를 0으로 리셋한다.  <br /></td></tr>
<tr class="memitem:a887559495f97e26d7fa0ef0a2c5c84f0" id="r_a887559495f97e26d7fa0ef0a2c5c84f0"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#a887559495f97e26d7fa0ef0a2c5c84f0">Init_Spd_PLL</a> (struct INVERTER *<a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>, float Ws)</td></tr>
<tr class="memdesc:a887559495f97e26d7fa0ef0a2c5c84f0"><td class="mdescLeft">&#160;</td><td class="mdescRight">속도 PLL(Phase-Locked Loop) 옵저버를 초기화한다.  <br /></td></tr>
<tr class="memitem:a9fabfabf3cf816a557870ac6174ba05b" id="r_a9fabfabf3cf816a557870ac6174ba05b"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#a9fabfabf3cf816a557870ac6174ba05b">UpdateController</a> (struct INVERTER *<a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>)</td></tr>
<tr class="memdesc:a9fabfabf3cf816a557870ac6174ba05b"><td class="mdescLeft">&#160;</td><td class="mdescRight">제어기 게인을 현재 파라미터로 갱신한다.  <br /></td></tr>
<tr class="memitem:a1f6df58c2a073ad2274f97f6a504c96d" id="r_a1f6df58c2a073ad2274f97f6a504c96d"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#a1f6df58c2a073ad2274f97f6a504c96d">ResetController</a> (struct INVERTER *<a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>)</td></tr>
<tr class="memdesc:a1f6df58c2a073ad2274f97f6a504c96d"><td class="mdescLeft">&#160;</td><td class="mdescRight">모든 제어 상태 변수를 초기값으로 리셋한다.  <br /></td></tr>
<tr class="memitem:a7c9cfee082f7d95396b41b6fd5b0676d" id="r_a7c9cfee082f7d95396b41b6fd5b0676d"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#a7c9cfee082f7d95396b41b6fd5b0676d">TorqueControl</a> (struct INVERTER *<a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>)</td></tr>
<tr class="memdesc:a7c9cfee082f7d95396b41b6fd5b0676d"><td class="mdescLeft">&#160;</td><td class="mdescRight">토크 제어 함수 (듀티 사이클 기반 토크 기준 생성)  <br /></td></tr>
<tr class="memitem:a68f857bdf76878fd721ac48e6c354997" id="r_a68f857bdf76878fd721ac48e6c354997"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#a68f857bdf76878fd721ac48e6c354997">CurrentControl</a> (struct INVERTER *<a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>)</td></tr>
<tr class="memdesc:a68f857bdf76878fd721ac48e6c354997"><td class="mdescLeft">&#160;</td><td class="mdescRight">PI 전류 제어기 (d-q 동기 좌표계)  <br /></td></tr>
<tr class="memitem:aa0c62359efaad04d667cc7d8d3e169e6" id="r_aa0c62359efaad04d667cc7d8d3e169e6"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#aa0c62359efaad04d667cc7d8d3e169e6">SpeedControl</a> (struct INVERTER *<a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>)</td></tr>
<tr class="memdesc:aa0c62359efaad04d667cc7d8d3e169e6"><td class="mdescLeft">&#160;</td><td class="mdescRight">PI 속도 제어기 (rpm → 토크 기준 생성)  <br /></td></tr>
<tr class="memitem:a964ec348ab2be811f76c85501ac14208" id="r_a964ec348ab2be811f76c85501ac14208"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#a964ec348ab2be811f76c85501ac14208">OpenLoopControl</a> (struct INVERTER *<a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>)</td></tr>
<tr class="memdesc:a964ec348ab2be811f76c85501ac14208"><td class="mdescLeft">&#160;</td><td class="mdescRight">전류 개루프 제어 (Open-Loop Current Control)  <br /></td></tr>
<tr class="memitem:a01248186cec9f4dadc54e4c94be940cf" id="r_a01248186cec9f4dadc54e4c94be940cf"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#a01248186cec9f4dadc54e4c94be940cf">Vref_GenControl</a> (struct INVERTER *<a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>)</td></tr>
<tr class="memdesc:a01248186cec9f4dadc54e4c94be940cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">전압 기준 생성 제어 (전압 피드포워드 방식)  <br /></td></tr>
<tr class="memitem:aefbd0b8bc957317d7f22f0db0185683d" id="r_aefbd0b8bc957317d7f22f0db0185683d"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#aefbd0b8bc957317d7f22f0db0185683d">VoltageOpenLoopControl</a> (struct INVERTER *<a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>)</td></tr>
<tr class="memdesc:aefbd0b8bc957317d7f22f0db0185683d"><td class="mdescLeft">&#160;</td><td class="mdescRight">전압 개루프 제어 (Voltage Open-Loop Control)  <br /></td></tr>
<tr class="memitem:aedf8f86f640274dface77130a3d50207" id="r_aedf8f86f640274dface77130a3d50207"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#aedf8f86f640274dface77130a3d50207">VoltageInjection_SquareWave</a> (struct INVERTER *<a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>)</td></tr>
<tr class="memdesc:aedf8f86f640274dface77130a3d50207"><td class="mdescLeft">&#160;</td><td class="mdescRight">d축 구형파 전압 주입 (파라미터 추정용)  <br /></td></tr>
<tr class="memitem:a3db77525a1b8b485f18baebc7e086cb1" id="r_a3db77525a1b8b485f18baebc7e086cb1"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#a3db77525a1b8b485f18baebc7e086cb1">Hallsensor_Observer</a> (struct INVERTER *<a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>)</td></tr>
<tr class="memdesc:a3db77525a1b8b485f18baebc7e086cb1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Hall 센서 기반 속도/위치 PLL 옵저버  <br /></td></tr>
<tr class="memitem:a158783ba9a4d5687c5fc417acfcc74a4" id="r_a158783ba9a4d5687c5fc417acfcc74a4"><td class="memItemLeft">uint8_t&#160;</td><td class="memItemRight"><a class="el" href="#a158783ba9a4d5687c5fc417acfcc74a4">GetHallSensorState</a> (GPIO_PinState hall_sensor_1, GPIO_PinState hall_sensor_2, GPIO_PinState hall_sensor_3)</td></tr>
<tr class="memdesc:a158783ba9a4d5687c5fc417acfcc74a4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Hall 센서 3개의 상태를 3비트 정수로 변환한다.  <br /></td></tr>
<tr class="memitem:a5eb5c4adfd5c3833415678e1da00bf93" id="r_a5eb5c4adfd5c3833415678e1da00bf93"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#a5eb5c4adfd5c3833415678e1da00bf93">HallPosition_Test</a> (struct INVERTER *<a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>)</td></tr>
<tr class="memdesc:a5eb5c4adfd5c3833415678e1da00bf93"><td class="mdescLeft">&#160;</td><td class="mdescRight">Hall 위치 테스트: 기본 전압 벡터를 순차 인가한다.  <br /></td></tr>
<tr class="memitem:ad14c7779ae276ada8516bc3d58997206" id="r_ad14c7779ae276ada8516bc3d58997206"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#ad14c7779ae276ada8516bc3d58997206">Align</a> (struct INVERTER *<a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>)</td></tr>
<tr class="memdesc:ad14c7779ae276ada8516bc3d58997206"><td class="mdescLeft">&#160;</td><td class="mdescRight">d축 전류 정렬 절차 (4단계 상태 머신)  <br /></td></tr>
<tr class="memitem:a031511fea69b8fce19a44f86eb1858fe" id="r_a031511fea69b8fce19a44f86eb1858fe"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#a031511fea69b8fce19a44f86eb1858fe">PwmSwOn</a> (void)</td></tr>
<tr class="memdesc:a031511fea69b8fce19a44f86eb1858fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">TIM1 PWM 출력을 활성화한다 (3상 상하 암 모두).  <br /></td></tr>
<tr class="memitem:a9013a288bba48367bf9d57702c80b1ee" id="r_a9013a288bba48367bf9d57702c80b1ee"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#a9013a288bba48367bf9d57702c80b1ee">PwmSwOff</a> (void)</td></tr>
<tr class="memdesc:a9013a288bba48367bf9d57702c80b1ee"><td class="mdescLeft">&#160;</td><td class="mdescRight">TIM1 PWM 출력을 비활성화한다.  <br /></td></tr>
<tr class="memitem:a4b849dca1f135dd860c6f0ce88cc7c13" id="r_a4b849dca1f135dd860c6f0ce88cc7c13"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#a4b849dca1f135dd860c6f0ce88cc7c13">PwmDutyUpt</a> (void)</td></tr>
<tr class="memdesc:a4b849dca1f135dd860c6f0ce88cc7c13"><td class="mdescLeft">&#160;</td><td class="mdescRight">TIM1 CCR 레지스터에 듀티비를 업데이트한다.  <br /></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-var-members" class="groupheader"><a id="var-members" name="var-members"></a>
변수</h2></td></tr>
<tr class="memitem:ga25fc663547539bc49fecc0011bd76ab5" id="r_ga25fc663547539bc49fecc0011bd76ab5"><td class="memItemLeft">TIM_HandleTypeDef&#160;</td><td class="memItemRight"><a class="el" href="group___t_i_m___handles.html#ga25fc663547539bc49fecc0011bd76ab5">htim1</a></td></tr>
<tr class="memdesc:ga25fc663547539bc49fecc0011bd76ab5"><td class="mdescLeft">&#160;</td><td class="mdescRight">TIM1 핸들: 3상 PWM 출력  <br /></td></tr>
<tr class="memitem:aac3d2c59ee0e3bbae1b99529a154eb62" id="r_aac3d2c59ee0e3bbae1b99529a154eb62"><td class="memItemLeft">TIM_HandleTypeDef&#160;</td><td class="memItemRight"><a class="el" href="#aac3d2c59ee0e3bbae1b99529a154eb62">htim3</a></td></tr>
<tr class="memitem:ab5e71ba0276929fe061bacdcc22c3335" id="r_ab5e71ba0276929fe061bacdcc22c3335"><td class="memItemLeft">float&#160;</td><td class="memItemRight"><a class="el" href="#ab5e71ba0276929fe061bacdcc22c3335">dutyCycle</a></td></tr>
<tr class="memdesc:ab5e71ba0276929fe061bacdcc22c3335"><td class="mdescLeft">&#160;</td><td class="mdescRight">RC 수신기 입력 듀티 사이클 값 [0.0, 1.0]  <br /></td></tr>
<tr class="memitem:a5b799dff3aee9e48ae67cfe1f9075e30" id="r_a5b799dff3aee9e48ae67cfe1f9075e30"><td class="memItemLeft">struct INVERTER&#160;</td><td class="memItemRight"><a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a></td></tr>
<tr class="memdesc:a5b799dff3aee9e48ae67cfe1f9075e30"><td class="mdescLeft">&#160;</td><td class="mdescRight">인버터 전역 상태/파라미터 구조체  <br /></td></tr>
<tr class="memitem:a90e45c5ed8c3f0ed09963d378e1ad75a" id="r_a90e45c5ed8c3f0ed09963d378e1ad75a"><td class="memItemLeft">int&#160;</td><td class="memItemRight"><a class="el" href="#a90e45c5ed8c3f0ed09963d378e1ad75a">Mode_align</a> = 0</td></tr>
<tr class="memdesc:a90e45c5ed8c3f0ed09963d378e1ad75a"><td class="mdescLeft">&#160;</td><td class="mdescRight">정렬 상태 머신 단계 (0~3)  <br /></td></tr>
<tr class="memitem:ad09af8d36a15d8f6f38d126a90b36862" id="r_ad09af8d36a15d8f6f38d126a90b36862"><td class="memItemLeft">float&#160;</td><td class="memItemRight"><a class="el" href="#ad09af8d36a15d8f6f38d126a90b36862">Time_align</a> = 0.</td></tr>
<tr class="memdesc:ad09af8d36a15d8f6f38d126a90b36862"><td class="mdescLeft">&#160;</td><td class="mdescRight">정렬 경과 시간 [s]  <br /></td></tr>
<tr class="memitem:adc9491aaf3043e1e99f084debf0bd167" id="r_adc9491aaf3043e1e99f084debf0bd167"><td class="memItemLeft">int&#160;</td><td class="memItemRight"><a class="el" href="#adc9491aaf3043e1e99f084debf0bd167">cnt_inj</a> = 0</td></tr>
<tr class="memdesc:adc9491aaf3043e1e99f084debf0bd167"><td class="mdescLeft">&#160;</td><td class="mdescRight">구형파 주입 카운터 (홀짝 토글)  <br /></td></tr>
<tr class="memitem:afcd0f0ee99ff421a667c81624818d6ae" id="r_afcd0f0ee99ff421a667c81624818d6ae"><td class="memItemLeft">float&#160;</td><td class="memItemRight"><a class="el" href="#afcd0f0ee99ff421a667c81624818d6ae">W_LPF_set</a> = 50.f</td></tr>
<tr class="memdesc:afcd0f0ee99ff421a667c81624818d6ae"><td class="mdescLeft">&#160;</td><td class="mdescRight">속도 LPF 차단 주파수 설정값 [Hz]  <br /></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">상세한 설명</h2>
<div class="textblock"><p>인버터 제어 핵심 알고리즘 모듈 </p>
<p>PMSM(영구자석 동기 전동기) 제어에 필요한 파라미터 초기화, 전류/속도/전압 제어기, 개루프 제어, Hall 센서 옵저버, PWM 출력 관리 함수를 포함한다.</p>
<p>좌표계 표기 규칙: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">접미사  </th><th class="markdownTableHeadNone">좌표계  </th><th class="markdownTableHeadNone">축  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ss  </td><td class="markdownTableBodyNone">정지 좌표계 (α-β)  </td><td class="markdownTableBodyNone">α(d), β(q)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">sr  </td><td class="markdownTableBodyNone">동기 좌표계 (d-q)  </td><td class="markdownTableBodyNone">d(자속), q(토크)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">r  </td><td class="markdownTableBodyNone">회전자 기준  </td><td class="markdownTableBodyNone">-  </td></tr>
</table>
<p>주요 제어 함수 목록: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">함수  </th><th class="markdownTableHeadNone">역할  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="#a917cf2e97121d1990d40ef50799f3ecd" title="전동기 및 인버터 기본 파라미터를 초기화한다.">InitParameter()</a>  </td><td class="markdownTableBodyNone">전동기/인버터 파라미터 초기화  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="#a643273242fd423931f39716c68ac91bf" title="전류 제어기를 초기화하고 관련 상태 변수를 0으로 리셋한다.">InitCurrentController()</a>  </td><td class="markdownTableBodyNone">PI 전류 제어기 초기화  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="#a0e276774794e294c9ba7a8ec91266d75" title="속도 제어기를 초기화하고 관련 상태 변수를 0으로 리셋한다.">InitSpeedController()</a>  </td><td class="markdownTableBodyNone">PI 속도 제어기 초기화  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="#a887559495f97e26d7fa0ef0a2c5c84f0" title="속도 PLL(Phase-Locked Loop) 옵저버를 초기화한다.">Init_Spd_PLL()</a>  </td><td class="markdownTableBodyNone">속도 PLL 옵저버 초기화  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="#a9fabfabf3cf816a557870ac6174ba05b" title="제어기 게인을 현재 파라미터로 갱신한다.">UpdateController()</a>  </td><td class="markdownTableBodyNone">실시간 게인 갱신  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="#a1f6df58c2a073ad2274f97f6a504c96d" title="모든 제어 상태 변수를 초기값으로 리셋한다.">ResetController()</a>  </td><td class="markdownTableBodyNone">모든 상태 변수 초기화  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="#a7c9cfee082f7d95396b41b6fd5b0676d" title="토크 제어 함수 (듀티 사이클 기반 토크 기준 생성)">TorqueControl()</a>  </td><td class="markdownTableBodyNone">토크 기준 생성 (dutyCycle 기반)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="#a68f857bdf76878fd721ac48e6c354997" title="PI 전류 제어기 (d-q 동기 좌표계)">CurrentControl()</a>  </td><td class="markdownTableBodyNone">d-q 축 PI 전류 제어 + SVPWM 출력  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="#aa0c62359efaad04d667cc7d8d3e169e6" title="PI 속도 제어기 (rpm → 토크 기준 생성)">SpeedControl()</a>  </td><td class="markdownTableBodyNone">PI 속도 제어 → 토크 기준 생성  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="#a964ec348ab2be811f76c85501ac14208" title="전류 개루프 제어 (Open-Loop Current Control)">OpenLoopControl()</a>  </td><td class="markdownTableBodyNone">전류 개루프 제어  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="#a01248186cec9f4dadc54e4c94be940cf" title="전압 기준 생성 제어 (전압 피드포워드 방식)">Vref_GenControl()</a>  </td><td class="markdownTableBodyNone">전압 피드포워드 기준 생성  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="#aefbd0b8bc957317d7f22f0db0185683d" title="전압 개루프 제어 (Voltage Open-Loop Control)">VoltageOpenLoopControl()</a>  </td><td class="markdownTableBodyNone">전압 개루프 제어  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="#aedf8f86f640274dface77130a3d50207" title="d축 구형파 전압 주입 (파라미터 추정용)">VoltageInjection_SquareWave()</a>  </td><td class="markdownTableBodyNone">d축 구형파 주입 (파라미터 추정)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="#a3db77525a1b8b485f18baebc7e086cb1" title="Hall 센서 기반 속도/위치 PLL 옵저버">Hallsensor_Observer()</a>  </td><td class="markdownTableBodyNone">Hall PLL 속도/위치 추정  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="#a158783ba9a4d5687c5fc417acfcc74a4" title="Hall 센서 3개의 상태를 3비트 정수로 변환한다.">GetHallSensorState()</a>  </td><td class="markdownTableBodyNone">Hall 3비트 상태 읽기  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="#a5eb5c4adfd5c3833415678e1da00bf93" title="Hall 위치 테스트: 기본 전압 벡터를 순차 인가한다.">HallPosition_Test()</a>  </td><td class="markdownTableBodyNone">기본 벡터 순차 인가 (Hall 확인)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="#ad14c7779ae276ada8516bc3d58997206" title="d축 전류 정렬 절차 (4단계 상태 머신)">Align()</a>  </td><td class="markdownTableBodyNone">d축 초기 정렬 (4단계 상태 머신)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="#a031511fea69b8fce19a44f86eb1858fe" title="TIM1 PWM 출력을 활성화한다 (3상 상하 암 모두).">PwmSwOn()</a> / <a class="el" href="#a9013a288bba48367bf9d57702c80b1ee" title="TIM1 PWM 출력을 비활성화한다.">PwmSwOff()</a>  </td><td class="markdownTableBodyNone">TIM1 PWM 채널 시작/정지  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="#a4b849dca1f135dd860c6f0ce88cc7c13" title="TIM1 CCR 레지스터에 듀티비를 업데이트한다.">PwmDutyUpt()</a>  </td><td class="markdownTableBodyNone">TIM1 CCR 레지스터 듀티 갱신  </td></tr>
</table>
<dl class="section author"><dt>작성자</dt><dd>HALAB_G </dd></dl>
<dl class="section date"><dt>날짜</dt><dd>2024-11-29 </dd></dl>

<p class="definition"><a class="el" href="inv_8c_source.html">inv.c</a> 파일에서 정의되었습니다.</p>
</div><a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">함수 문서화</h2>
<a id="ad14c7779ae276ada8516bc3d58997206" name="ad14c7779ae276ada8516bc3d58997206"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad14c7779ae276ada8516bc3d58997206">&#9670;&#160;</a></span>Align()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Align </td>
          <td>(</td>
          <td class="paramtype">struct INVERTER *</td>          <td class="paramname"><span class="paramname"><em>INV</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>d축 전류 정렬 절차 (4단계 상태 머신) </p>
<p>엔코더/센서 초기화를 위해 d축 방향으로 전류를 인가하여 회전자를 정렬시킨다.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Mode_align  </th><th class="markdownTableHeadNone">동작  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0  </td><td class="markdownTableBodyNone">초기화 (Id_ref = Idsr_align)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">CurrentControl 실행, 4초 대기  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone">Id_ref = 0으로 감쇠, 1초 더 대기  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">3  </td><td class="markdownTableBodyNone">정렬 완료, FLAG.INV_ALIGN = 0  </td></tr>
</table>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname"><a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30" title="인버터 전역 상태/파라미터 구조체">INV</a></td><td>인버터 구조체 포인터 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>주의</dt><dd>Time_align은 Tsamp 단위로 매 호출마다 누산된다. </dd></dl>

<p class="definition"><a class="el" href="inv_8c_source.html">inv.c</a> 파일의 <a class="el" href="inv_8c_source.html#l00867">867</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  868</span>{</div>
<div class="line"><span class="lineno">  869</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar = 0.;</div>
<div class="line"><span class="lineno">  870</span> </div>
<div class="line"><span class="lineno">  871</span>    <span class="keywordflow">switch</span> (<a class="code hl_variable" href="#a90e45c5ed8c3f0ed09963d378e1ad75a">Mode_align</a>) {</div>
<div class="line"><span class="lineno">  872</span>        <span class="keywordflow">case</span> 0:</div>
<div class="line"><span class="lineno">  873</span>            <a class="code hl_variable" href="group___control_mode.html#gac8cf438350a0d309f204837cbdfa492a">Align_done</a>        = 0;</div>
<div class="line"><span class="lineno">  874</span>            <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_offset = 0.;</div>
<div class="line"><span class="lineno">  875</span>            <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref     = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_align;</div>
<div class="line"><span class="lineno">  876</span>            <a class="code hl_variable" href="#ad09af8d36a15d8f6f38d126a90b36862">Time_align</a>        = 0.;</div>
<div class="line"><span class="lineno">  877</span>            <a class="code hl_variable" href="#a90e45c5ed8c3f0ed09963d378e1ad75a">Mode_align</a>++;</div>
<div class="line"><span class="lineno">  878</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  879</span>        <span class="keywordflow">case</span> 1:</div>
<div class="line"><span class="lineno">  880</span>            <a class="code hl_function" href="#a68f857bdf76878fd721ac48e6c354997">CurrentControl</a>(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>);</div>
<div class="line"><span class="lineno">  881</span>            <a class="code hl_function" href="#a4b849dca1f135dd860c6f0ce88cc7c13">PwmDutyUpt</a>();</div>
<div class="line"><span class="lineno">  882</span>            <a class="code hl_function" href="#a031511fea69b8fce19a44f86eb1858fe">PwmSwOn</a>();</div>
<div class="line"><span class="lineno">  883</span>            <span class="keywordflow">if</span> (!<a class="code hl_variable" href="flag_8c.html#ac09613eff9a28b2750787c13d7d6fdc9">FLAG</a>.FAULT) PWM_BUF_ON;</div>
<div class="line"><span class="lineno">  884</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="#ad09af8d36a15d8f6f38d126a90b36862">Time_align</a> &gt;= 4.) <a class="code hl_variable" href="#a90e45c5ed8c3f0ed09963d378e1ad75a">Mode_align</a>++;</div>
<div class="line"><span class="lineno">  885</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  886</span>        <span class="keywordflow">case</span> 2:</div>
<div class="line"><span class="lineno">  887</span>            <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref = 0.;</div>
<div class="line"><span class="lineno">  888</span>            <a class="code hl_function" href="#a68f857bdf76878fd721ac48e6c354997">CurrentControl</a>(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>);</div>
<div class="line"><span class="lineno">  889</span>            <a class="code hl_function" href="#a4b849dca1f135dd860c6f0ce88cc7c13">PwmDutyUpt</a>();</div>
<div class="line"><span class="lineno">  890</span>            <a class="code hl_function" href="#a031511fea69b8fce19a44f86eb1858fe">PwmSwOn</a>();</div>
<div class="line"><span class="lineno">  891</span>            <span class="keywordflow">if</span> (!<a class="code hl_variable" href="flag_8c.html#ac09613eff9a28b2750787c13d7d6fdc9">FLAG</a>.FAULT) PWM_BUF_ON;</div>
<div class="line"><span class="lineno">  892</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="#ad09af8d36a15d8f6f38d126a90b36862">Time_align</a> &gt;= 5.) <a class="code hl_variable" href="#a90e45c5ed8c3f0ed09963d378e1ad75a">Mode_align</a>++;</div>
<div class="line"><span class="lineno">  893</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  894</span>        <span class="keywordflow">case</span> 3:</div>
<div class="line"><span class="lineno">  895</span>            <a class="code hl_variable" href="#a90e45c5ed8c3f0ed09963d378e1ad75a">Mode_align</a>     = 0;</div>
<div class="line"><span class="lineno">  896</span>            <a class="code hl_variable" href="group___control_mode.html#gac8cf438350a0d309f204837cbdfa492a">Align_done</a>     = 1;</div>
<div class="line"><span class="lineno">  897</span>            <a class="code hl_variable" href="flag_8c.html#ac09613eff9a28b2750787c13d7d6fdc9">FLAG</a>.INV_ALIGN = 0;</div>
<div class="line"><span class="lineno">  898</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  899</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  900</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  901</span>    }</div>
<div class="line"><span class="lineno">  902</span>    <a class="code hl_variable" href="#ad09af8d36a15d8f6f38d126a90b36862">Time_align</a> += Tsamp;</div>
<div class="line"><span class="lineno">  903</span>}</div>
<div class="ttc" id="aflag_8c_html_ac09613eff9a28b2750787c13d7d6fdc9"><div class="ttname"><a href="flag_8c.html#ac09613eff9a28b2750787c13d7d6fdc9">FLAG</a></div><div class="ttdeci">struct CONTROL_FLAG FLAG</div><div class="ttdoc">제어 플래그 전역 구조체 (시스템 시작 시 모두 0으로 초기화)</div><div class="ttdef"><b>Definition</b> <a href="flag_8c_source.html#l00041">flag.c:41</a></div></div>
<div class="ttc" id="agroup___control_mode_html_gac8cf438350a0d309f204837cbdfa492a"><div class="ttname"><a href="group___control_mode.html#gac8cf438350a0d309f204837cbdfa492a">Align_done</a></div><div class="ttdeci">int Align_done</div><div class="ttdoc">d축 정렬 완료 플래그 (0: 미완료, 1: 완료)</div><div class="ttdef"><b>Definition</b> <a href="variable_8c_source.html#l00024">variable.c:24</a></div></div>
<div class="ttc" id="ainv_8c_html_a031511fea69b8fce19a44f86eb1858fe"><div class="ttname"><a href="#a031511fea69b8fce19a44f86eb1858fe">PwmSwOn</a></div><div class="ttdeci">void PwmSwOn(void)</div><div class="ttdoc">TIM1 PWM 출력을 활성화한다 (3상 상하 암 모두).</div><div class="ttdef"><b>Definition</b> <a href="inv_8c_source.html#l00914">inv.c:914</a></div></div>
<div class="ttc" id="ainv_8c_html_a4b849dca1f135dd860c6f0ce88cc7c13"><div class="ttname"><a href="#a4b849dca1f135dd860c6f0ce88cc7c13">PwmDutyUpt</a></div><div class="ttdeci">void PwmDutyUpt(void)</div><div class="ttdoc">TIM1 CCR 레지스터에 듀티비를 업데이트한다.</div><div class="ttdef"><b>Definition</b> <a href="inv_8c_source.html#l00953">inv.c:953</a></div></div>
<div class="ttc" id="ainv_8c_html_a5b799dff3aee9e48ae67cfe1f9075e30"><div class="ttname"><a href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a></div><div class="ttdeci">struct INVERTER INV</div><div class="ttdoc">인버터 전역 상태/파라미터 구조체</div><div class="ttdef"><b>Definition</b> <a href="inv_8c_source.html#l00053">inv.c:53</a></div></div>
<div class="ttc" id="ainv_8c_html_a68f857bdf76878fd721ac48e6c354997"><div class="ttname"><a href="#a68f857bdf76878fd721ac48e6c354997">CurrentControl</a></div><div class="ttdeci">void CurrentControl(struct INVERTER *INV)</div><div class="ttdoc">PI 전류 제어기 (d-q 동기 좌표계)</div><div class="ttdef"><b>Definition</b> <a href="inv_8c_source.html#l00354">inv.c:354</a></div></div>
<div class="ttc" id="ainv_8c_html_a90e45c5ed8c3f0ed09963d378e1ad75a"><div class="ttname"><a href="#a90e45c5ed8c3f0ed09963d378e1ad75a">Mode_align</a></div><div class="ttdeci">int Mode_align</div><div class="ttdoc">정렬 상태 머신 단계 (0~3)</div><div class="ttdef"><b>Definition</b> <a href="inv_8c_source.html#l00055">inv.c:55</a></div></div>
<div class="ttc" id="ainv_8c_html_ad09af8d36a15d8f6f38d126a90b36862"><div class="ttname"><a href="#ad09af8d36a15d8f6f38d126a90b36862">Time_align</a></div><div class="ttdeci">float Time_align</div><div class="ttdoc">정렬 경과 시간 [s]</div><div class="ttdef"><b>Definition</b> <a href="inv_8c_source.html#l00056">inv.c:56</a></div></div>
</div><!-- fragment --><div class="dynheader">
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="inv_8c_ad14c7779ae276ada8516bc3d58997206_cgraph.png" border="0" usemap="#ainv_8c_ad14c7779ae276ada8516bc3d58997206_cgraph" loading="lazy" alt=""/></div>
<map name="ainv_8c_ad14c7779ae276ada8516bc3d58997206_cgraph" id="ainv_8c_ad14c7779ae276ada8516bc3d58997206_cgraph">
<area shape="rect" title="d축 전류 정렬 절차 (4단계 상태 머신)" alt="" coords="5,31,56,57"/>
<area shape="rect" href="inv_8c.html#a68f857bdf76878fd721ac48e6c354997" title="PI 전류 제어기 (d&#45;q 동기 좌표계)" alt="" coords="104,31,210,57"/>
<area shape="poly" title=" " alt="" coords="56,41,91,42,86,46,57,47"/>
<area shape="rect" href="inv_8c.html#a4b849dca1f135dd860c6f0ce88cc7c13" title="TIM1 CCR 레지스터에 듀티비를 업데이트한다." alt="" coords="258,5,358,32"/>
<area shape="poly" title=" " alt="" coords="55,31,103,16,175,10,245,12,240,14,175,15,104,21,57,36"/>
<area shape="rect" href="inv_8c.html#a031511fea69b8fce19a44f86eb1858fe" title="TIM1 PWM 출력을 활성화한다 (3상 상하 암 모두)." alt="" coords="264,68,352,95"/>
<area shape="poly" title=" " alt="" coords="56,52,104,67,179,77,252,82,246,82,179,82,103,72,56,57"/>
<area shape="poly" title=" " alt="" coords="210,32,245,29,240,30,211,38"/>
<area shape="poly" title=" " alt="" coords="211,55,252,67,247,67,210,60"/>
</map>
</div>
<div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="inv_8c_ad14c7779ae276ada8516bc3d58997206_icgraph.png" border="0" usemap="#ainv_8c_ad14c7779ae276ada8516bc3d58997206_icgraph" loading="lazy" alt=""/></div>
<map name="ainv_8c_ad14c7779ae276ada8516bc3d58997206_icgraph" id="ainv_8c_ad14c7779ae276ada8516bc3d58997206_icgraph">
<area shape="rect" title="d축 전류 정렬 절차 (4단계 상태 머신)" alt="" coords="292,5,342,32"/>
<area shape="rect" href="control_8c.html#afb486c446e28753e3dca5112dfdc8264" title="PMSM 메인 제어 함수 (TIM2 인터럽트에서 100µs 주기로 호출)" alt="" coords="181,5,244,32"/>
<area shape="poly" title=" " alt="" coords="274,19,244,21,244,16,279,19"/>
<area shape="rect" href="stm32g4xx__it_8c.html#a38ad4725462bdc5e86c4ead4f04b9fc2" title="TIM2 글로벌 인터럽트 핸들러 ★ 제어 루프 진입점 ★" alt="" coords="5,5,133,32"/>
<area shape="poly" title=" " alt="" coords="162,19,133,21,133,16,168,18"/>
</map>
</div>

</div>
</div>
<a id="a68f857bdf76878fd721ac48e6c354997" name="a68f857bdf76878fd721ac48e6c354997"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68f857bdf76878fd721ac48e6c354997">&#9670;&#160;</a></span>CurrentControl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CurrentControl </td>
          <td>(</td>
          <td class="paramtype">struct INVERTER *</td>          <td class="paramname"><span class="paramname"><em>INV</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>PI 전류 제어기 (d-q 동기 좌표계) </p>
<p>dq 전류 오차에 대한 PI 제어를 수행하고 결과를 3상 듀티로 변환한다.</p>
<p>처리 순서:</p><ol type="1">
<li>Clarke 변환: (Ia,Ib,Ic) → (Idss, Iqss)</li>
<li>Park 변환: (Idss, Iqss) + Thetar → (Idsr, Iqsr)</li>
<li>PI 제어 (Anti-windup 포함) → Vdsr_ref, Vqsr_ref</li>
<li>역Park 변환 → (Vdss_ref, Vqss_ref)</li>
<li>역Clarke 변환 → (Vas_ref, Vbs_ref, Vcs_ref)</li>
<li>SVPWM 오프셋 계산 (min-max 방식)</li>
<li>NLC(비선형 보상) 전압 추가</li>
<li>듀티비 계산 및 PWM 출력</li>
</ol>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname"><a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30" title="인버터 전역 상태/파라미터 구조체">INV</a></td><td>인버터 구조체 포인터 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>주의</dt><dd>Theta_mode==1 이면 OLC 각도 사용, 아니면 Hall PLL 각도 사용 </dd></dl>
<dl class="section warning"><dt>경고</dt><dd>FLAG.FAULT 발생 시 PWM_BUF_OFF 유지 </dd></dl>

<p class="definition"><a class="el" href="inv_8c_source.html">inv.c</a> 파일의 <a class="el" href="inv_8c_source.html#l00354">354</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  355</span>{</div>
<div class="line"><span class="lineno">  356</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="flag_8c.html#ac09613eff9a28b2750787c13d7d6fdc9">FLAG</a>.INV_RUN) {</div>
<div class="line"><span class="lineno">  357</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_ref_unsat = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;INV_Kt;</div>
<div class="line"><span class="lineno">  358</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_ref = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_ref_unsat, -3.f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Is_rated, 3.f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Is_rated);</div>
<div class="line"><span class="lineno">  359</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref = 0;</div>
<div class="line"><span class="lineno">  360</span>    }</div>
<div class="line"><span class="lineno">  361</span> </div>
<div class="line"><span class="lineno">  362</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_old = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref;</div>
<div class="line"><span class="lineno">  363</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_old = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref;</div>
<div class="line"><span class="lineno">  364</span> </div>
<div class="line"><span class="lineno">  365</span>    <span class="comment">/* Clarke 변환 (α-β) */</span></div>
<div class="line"><span class="lineno">  366</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idss = (2.f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ia - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ib - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ic) * INV_3;</div>
<div class="line"><span class="lineno">  367</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqss = (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ib - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ic) * INV_SQRT3;</div>
<div class="line"><span class="lineno">  368</span> </div>
<div class="line"><span class="lineno">  369</span>    <a class="code hl_variable" href="group___voltage_ref.html#ga94ab3777ddd48161a4945f405c0359a6">Vdss_ref_set</a> = (2.f * <a class="code hl_variable" href="group___voltage_ref.html#ga30c95cfd601124d7bb6a4535bdeb1f72">Van</a> - <a class="code hl_variable" href="group___voltage_ref.html#ga2f2a0c510c5b72110e5e3835c1c62555">Vbn</a> - <a class="code hl_variable" href="group___voltage_ref.html#ga99d72ed4a63ffab24762fc939a2b9c7d">Vcn</a>) * INV_3;</div>
<div class="line"><span class="lineno">  370</span>    <a class="code hl_variable" href="group___voltage_ref.html#ga8bf179fb2264726c2d6dc40618e56365">Vqss_ref_set</a> = INV_SQRT3 * (<a class="code hl_variable" href="group___voltage_ref.html#ga2f2a0c510c5b72110e5e3835c1c62555">Vbn</a> - <a class="code hl_variable" href="group___voltage_ref.html#ga99d72ed4a63ffab24762fc939a2b9c7d">Vcn</a>);</div>
<div class="line"><span class="lineno">  371</span> </div>
<div class="line"><span class="lineno">  372</span>    <span class="comment">/* 각도 선택 */</span></div>
<div class="line"><span class="lineno">  373</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="group___control_mode.html#ga5e542439936627687d1a27ac7b6b50c2">Theta_mode</a> == 1) {</div>
<div class="line"><span class="lineno">  374</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_OLC;</div>
<div class="line"><span class="lineno">  375</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wr     = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_OLC * RPM2RM * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;PP;</div>
<div class="line"><span class="lineno">  376</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  377</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_est_Hall;</div>
<div class="line"><span class="lineno">  378</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wr     = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wr_est_Hall;</div>
<div class="line"><span class="lineno">  379</span>    }</div>
<div class="line"><span class="lineno">  380</span> </div>
<div class="line"><span class="lineno">  381</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrm  = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wr * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;INV_PP;</div>
<div class="line"><span class="lineno">  382</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrm * RM2RPM;</div>
<div class="line"><span class="lineno">  383</span> </div>
<div class="line"><span class="lineno">  384</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_adv    = BOUND_PI(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar + 1.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wr * Tsamp);</div>
<div class="line"><span class="lineno">  385</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;cosThetar     = COS(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar);</div>
<div class="line"><span class="lineno">  386</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;sinThetar     = SIN(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar, <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar);</div>
<div class="line"><span class="lineno">  387</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;cosThetar_adv = COS(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_adv * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_adv);</div>
<div class="line"><span class="lineno">  388</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;sinThetar_adv = SIN(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_adv, <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_adv * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_adv);</div>
<div class="line"><span class="lineno">  389</span> </div>
<div class="line"><span class="lineno">  390</span>    <span class="comment">/* Park 변환 (d-q) */</span></div>
<div class="line"><span class="lineno">  391</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idss * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;cosThetar + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqss * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;sinThetar;</div>
<div class="line"><span class="lineno">  392</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr = -<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idss * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;sinThetar + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqss * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;cosThetar;</div>
<div class="line"><span class="lineno">  393</span> </div>
<div class="line"><span class="lineno">  394</span>    <span class="comment">/* PI 전류 제어 (Anti-windup 포함) */</span></div>
<div class="line"><span class="lineno">  395</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_err = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr;</div>
<div class="line"><span class="lineno">  396</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_err = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_ref - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr;</div>
<div class="line"><span class="lineno">  397</span> </div>
<div class="line"><span class="lineno">  398</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_integ += <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kid_cc * (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_err - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kad_cc * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_aw) * Tsamp;</div>
<div class="line"><span class="lineno">  399</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_integ += <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kiq_cc * (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_err - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kaq_cc * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_aw) * Tsamp;</div>
<div class="line"><span class="lineno">  400</span> </div>
<div class="line"><span class="lineno">  401</span>    <span class="comment">/* 피드포워드: 역기전력 분리 */</span></div>
<div class="line"><span class="lineno">  402</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_ff = -<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wr * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Lq * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_ref;</div>
<div class="line"><span class="lineno">  403</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_ff =  <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wr * (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ld * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Lamf);</div>
<div class="line"><span class="lineno">  404</span> </div>
<div class="line"><span class="lineno">  405</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_unsat_old = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kpd_cc * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_err + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_integ + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_ff - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ractive * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr;</div>
<div class="line"><span class="lineno">  406</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_unsat_old = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kpq_cc * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_err + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_integ + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_ff - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ractive * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr;</div>
<div class="line"><span class="lineno">  407</span> </div>
<div class="line"><span class="lineno">  408</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_unsat = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;alpha_LPF * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_unsat + (1 - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;alpha_LPF) * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_unsat_old;</div>
<div class="line"><span class="lineno">  409</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_unsat = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;alpha_LPF * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_unsat + (1 - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;alpha_LPF) * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_unsat_old;</div>
<div class="line"><span class="lineno">  410</span> </div>
<div class="line"><span class="lineno">  411</span>    <span class="comment">/* 전압 포화 제한 (√3/3 × Vdc) */</span></div>
<div class="line"><span class="lineno">  412</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_unsat, -<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc * INV_SQRT3, <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc * INV_SQRT3);</div>
<div class="line"><span class="lineno">  413</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_unsat, -<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc * INV_SQRT3, <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc * INV_SQRT3);</div>
<div class="line"><span class="lineno">  414</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_aw = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_unsat - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref;</div>
<div class="line"><span class="lineno">  415</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_aw = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_unsat - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref;</div>
<div class="line"><span class="lineno">  416</span> </div>
<div class="line"><span class="lineno">  417</span>    <span class="comment">/* 역Park 변환 */</span></div>
<div class="line"><span class="lineno">  418</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdss_ref = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;cosThetar_adv - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;sinThetar_adv;</div>
<div class="line"><span class="lineno">  419</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqss_ref = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;sinThetar_adv + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;cosThetar_adv;</div>
<div class="line"><span class="lineno">  420</span> </div>
<div class="line"><span class="lineno">  421</span>    <span class="comment">/* 역Clarke 변환 */</span></div>
<div class="line"><span class="lineno">  422</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vas_ref = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdss_ref;</div>
<div class="line"><span class="lineno">  423</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbs_ref = -0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdss_ref + SQRT3HALF * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqss_ref;</div>
<div class="line"><span class="lineno">  424</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcs_ref = -0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdss_ref - SQRT3HALF * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqss_ref;</div>
<div class="line"><span class="lineno">  425</span> </div>
<div class="line"><span class="lineno">  426</span>    <span class="comment">/* SVPWM 오프셋 (min-max 중간값) */</span></div>
<div class="line"><span class="lineno">  427</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmax = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vas_ref;</div>
<div class="line"><span class="lineno">  428</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmax &lt; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbs_ref) <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmax = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbs_ref;</div>
<div class="line"><span class="lineno">  429</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmax &lt; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcs_ref) <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmax = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcs_ref;</div>
<div class="line"><span class="lineno">  430</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmin = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vas_ref;</div>
<div class="line"><span class="lineno">  431</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmin &gt; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbs_ref) <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmin = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbs_ref;</div>
<div class="line"><span class="lineno">  432</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmin &gt; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcs_ref) <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmin = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcs_ref;</div>
<div class="line"><span class="lineno">  433</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Voffset = -0.5f * (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmax + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmin);</div>
<div class="line"><span class="lineno">  434</span> </div>
<div class="line"><span class="lineno">  435</span>    <span class="comment">/* 전류 기준 역변환 (참조용) */</span></div>
<div class="line"><span class="lineno">  436</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idss_ref = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;cosThetar_adv - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;sinThetar_adv;</div>
<div class="line"><span class="lineno">  437</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqss_ref = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;sinThetar_adv + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;cosThetar_adv;</div>
<div class="line"><span class="lineno">  438</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ia_ref = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idss_ref;</div>
<div class="line"><span class="lineno">  439</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ib_ref = -0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idss_ref + SQRT3HALF * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqss_ref;</div>
<div class="line"><span class="lineno">  440</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ic_ref = -0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idss_ref - SQRT3HALF * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqss_ref;</div>
<div class="line"><span class="lineno">  441</span> </div>
<div class="line"><span class="lineno">  442</span>    <span class="comment">/* NLC 비선형 보상 전압 */</span></div>
<div class="line"><span class="lineno">  443</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Va_NLC = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;A_NLC * atanf(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;B_NLC * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ia_ref);</div>
<div class="line"><span class="lineno">  444</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vb_NLC = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;A_NLC * atanf(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;B_NLC * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ib_ref);</div>
<div class="line"><span class="lineno">  445</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vc_NLC = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;A_NLC * atanf(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;B_NLC * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ic_ref);</div>
<div class="line"><span class="lineno">  446</span> </div>
<div class="line"><span class="lineno">  447</span>    <span class="comment">/* 최종 상전압 (NLC 포함) */</span></div>
<div class="line"><span class="lineno">  448</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Van_ref = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vas_ref + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Voffset + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Va_NLC, -0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc, 0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc);</div>
<div class="line"><span class="lineno">  449</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbn_ref = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbs_ref + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Voffset + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vb_NLC, -0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc, 0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc);</div>
<div class="line"><span class="lineno">  450</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcn_ref = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcs_ref + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Voffset + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vc_NLC, -0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc, 0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc);</div>
<div class="line"><span class="lineno">  451</span> </div>
<div class="line"><span class="lineno">  452</span>    <a class="code hl_variable" href="group___voltage_ref.html#ga30c95cfd601124d7bb6a4535bdeb1f72">Van</a> = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Van_ref; <a class="code hl_variable" href="group___voltage_ref.html#ga2f2a0c510c5b72110e5e3835c1c62555">Vbn</a> = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbn_ref; <a class="code hl_variable" href="group___voltage_ref.html#ga99d72ed4a63ffab24762fc939a2b9c7d">Vcn</a> = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcn_ref;</div>
<div class="line"><span class="lineno">  453</span> </div>
<div class="line"><span class="lineno">  454</span>    <span class="comment">/* 듀티비 계산 [0, 1] */</span></div>
<div class="line"><span class="lineno">  455</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_A = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Van_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;INV_Vdc + 0.5f, 0.f, 1.f);</div>
<div class="line"><span class="lineno">  456</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_B = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbn_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;INV_Vdc + 0.5f, 0.f, 1.f);</div>
<div class="line"><span class="lineno">  457</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_C = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcn_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;INV_Vdc + 0.5f, 0.f, 1.f);</div>
<div class="line"><span class="lineno">  458</span> </div>
<div class="line"><span class="lineno">  459</span>    <a class="code hl_function" href="#a031511fea69b8fce19a44f86eb1858fe">PwmSwOn</a>();</div>
<div class="line"><span class="lineno">  460</span>    <a class="code hl_function" href="#a4b849dca1f135dd860c6f0ce88cc7c13">PwmDutyUpt</a>();</div>
<div class="line"><span class="lineno">  461</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="flag_8c.html#ac09613eff9a28b2750787c13d7d6fdc9">FLAG</a>.FAULT) PWM_BUF_ON;</div>
<div class="line"><span class="lineno">  462</span>}</div>
<div class="ttc" id="agroup___control_mode_html_ga5e542439936627687d1a27ac7b6b50c2"><div class="ttname"><a href="group___control_mode.html#ga5e542439936627687d1a27ac7b6b50c2">Theta_mode</a></div><div class="ttdeci">int Theta_mode</div><div class="ttdoc">전기각 소스 선택 (0: Hall PLL, 1: OLC 개루프 각도)</div><div class="ttdef"><b>Definition</b> <a href="variable_8c_source.html#l00025">variable.c:25</a></div></div>
<div class="ttc" id="agroup___voltage_ref_html_ga2f2a0c510c5b72110e5e3835c1c62555"><div class="ttname"><a href="group___voltage_ref.html#ga2f2a0c510c5b72110e5e3835c1c62555">Vbn</a></div><div class="ttdeci">float Vbn</div><div class="ttdoc">B상 중성점 전압 기준 [V]</div><div class="ttdef"><b>Definition</b> <a href="variable_8c_source.html#l00041">variable.c:41</a></div></div>
<div class="ttc" id="agroup___voltage_ref_html_ga30c95cfd601124d7bb6a4535bdeb1f72"><div class="ttname"><a href="group___voltage_ref.html#ga30c95cfd601124d7bb6a4535bdeb1f72">Van</a></div><div class="ttdeci">float Van</div><div class="ttdoc">A상 중성점 전압 기준 [V] (CurrentControl 출력)</div><div class="ttdef"><b>Definition</b> <a href="variable_8c_source.html#l00040">variable.c:40</a></div></div>
<div class="ttc" id="agroup___voltage_ref_html_ga8bf179fb2264726c2d6dc40618e56365"><div class="ttname"><a href="group___voltage_ref.html#ga8bf179fb2264726c2d6dc40618e56365">Vqss_ref_set</a></div><div class="ttdeci">float Vqss_ref_set</div><div class="ttdoc">정지 좌표계 β축 전압 기준 [V]</div><div class="ttdef"><b>Definition</b> <a href="variable_8c_source.html#l00045">variable.c:45</a></div></div>
<div class="ttc" id="agroup___voltage_ref_html_ga94ab3777ddd48161a4945f405c0359a6"><div class="ttname"><a href="group___voltage_ref.html#ga94ab3777ddd48161a4945f405c0359a6">Vdss_ref_set</a></div><div class="ttdeci">float Vdss_ref_set</div><div class="ttdoc">정지 좌표계 α축 전압 기준 [V] (디버깅/모니터링용)</div><div class="ttdef"><b>Definition</b> <a href="variable_8c_source.html#l00044">variable.c:44</a></div></div>
<div class="ttc" id="agroup___voltage_ref_html_ga99d72ed4a63ffab24762fc939a2b9c7d"><div class="ttname"><a href="group___voltage_ref.html#ga99d72ed4a63ffab24762fc939a2b9c7d">Vcn</a></div><div class="ttdeci">float Vcn</div><div class="ttdoc">C상 중성점 전압 기준 [V]</div><div class="ttdef"><b>Definition</b> <a href="variable_8c_source.html#l00042">variable.c:42</a></div></div>
</div><!-- fragment --><div class="dynheader">
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="inv_8c_a68f857bdf76878fd721ac48e6c354997_cgraph.png" border="0" usemap="#ainv_8c_a68f857bdf76878fd721ac48e6c354997_cgraph" loading="lazy" alt=""/></div>
<map name="ainv_8c_a68f857bdf76878fd721ac48e6c354997_cgraph" id="ainv_8c_a68f857bdf76878fd721ac48e6c354997_cgraph">
<area shape="rect" title="PI 전류 제어기 (d&#45;q 동기 좌표계)" alt="" coords="5,31,112,57"/>
<area shape="rect" href="inv_8c.html#a4b849dca1f135dd860c6f0ce88cc7c13" title="TIM1 CCR 레지스터에 듀티비를 업데이트한다." alt="" coords="160,5,260,32"/>
<area shape="poly" title=" " alt="" coords="112,32,147,29,142,31,113,38"/>
<area shape="rect" href="inv_8c.html#a031511fea69b8fce19a44f86eb1858fe" title="TIM1 PWM 출력을 활성화한다 (3상 상하 암 모두)." alt="" coords="166,56,254,83"/>
<area shape="poly" title=" " alt="" coords="112,50,153,59,148,60,112,56"/>
</map>
</div>
<div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="inv_8c_a68f857bdf76878fd721ac48e6c354997_icgraph.png" border="0" usemap="#ainv_8c_a68f857bdf76878fd721ac48e6c354997_icgraph" loading="lazy" alt=""/></div>
<map name="ainv_8c_a68f857bdf76878fd721ac48e6c354997_icgraph" id="ainv_8c_a68f857bdf76878fd721ac48e6c354997_icgraph">
<area shape="rect" title="PI 전류 제어기 (d&#45;q 동기 좌표계)" alt="" coords="390,31,497,57"/>
<area shape="rect" href="inv_8c.html#ad14c7779ae276ada8516bc3d58997206" title="d축 전류 정렬 절차 (4단계 상태 머신)" alt="" coords="292,5,342,32"/>
<area shape="poly" title=" " alt="" coords="372,30,343,26,343,21,378,30"/>
<area shape="rect" href="control_8c.html#afb486c446e28753e3dca5112dfdc8264" title="PMSM 메인 제어 함수 (TIM2 인터럽트에서 100µs 주기로 호출)" alt="" coords="181,31,244,57"/>
<area shape="poly" title=" " alt="" coords="372,44,244,47,244,41,378,44"/>
<area shape="poly" title=" " alt="" coords="280,28,245,39,244,34,274,29"/>
<area shape="rect" href="stm32g4xx__it_8c.html#a38ad4725462bdc5e86c4ead4f04b9fc2" title="TIM2 글로벌 인터럽트 핸들러 ★ 제어 루프 진입점 ★" alt="" coords="5,31,133,57"/>
<area shape="poly" title=" " alt="" coords="162,44,133,47,133,41,168,44"/>
</map>
</div>

</div>
</div>
<a id="a158783ba9a4d5687c5fc417acfcc74a4" name="a158783ba9a4d5687c5fc417acfcc74a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a158783ba9a4d5687c5fc417acfcc74a4">&#9670;&#160;</a></span>GetHallSensorState()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t GetHallSensorState </td>
          <td>(</td>
          <td class="paramtype">GPIO_PinState</td>          <td class="paramname"><span class="paramname"><em>hall_sensor_1</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GPIO_PinState</td>          <td class="paramname"><span class="paramname"><em>hall_sensor_2</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GPIO_PinState</td>          <td class="paramname"><span class="paramname"><em>hall_sensor_3</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Hall 센서 3개의 상태를 3비트 정수로 변환한다. </p>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">hall_sensor_1</td><td>Hall A 핀 상태 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">hall_sensor_2</td><td>Hall B 핀 상태 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">hall_sensor_3</td><td>Hall C 핀 상태 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>반환값</dt><dd>3비트 Hall 상태값 (0~7) </dd></dl>

<p class="definition"><a class="el" href="inv_8c_source.html">inv.c</a> 파일의 <a class="el" href="inv_8c_source.html#l00819">819</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  822</span>{</div>
<div class="line"><span class="lineno">  823</span>    uint8_t hall_state = 0;</div>
<div class="line"><span class="lineno">  824</span>    hall_state |= (hall_sensor_1 == GPIO_PIN_SET) ? 0x01 : 0x00;</div>
<div class="line"><span class="lineno">  825</span>    hall_state |= (hall_sensor_2 == GPIO_PIN_SET) ? 0x02 : 0x00;</div>
<div class="line"><span class="lineno">  826</span>    hall_state |= (hall_sensor_3 == GPIO_PIN_SET) ? 0x04 : 0x00;</div>
<div class="line"><span class="lineno">  827</span>    <span class="keywordflow">return</span> hall_state;</div>
<div class="line"><span class="lineno">  828</span>}</div>
</div><!-- fragment --><div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="inv_8c_a158783ba9a4d5687c5fc417acfcc74a4_icgraph.png" border="0" usemap="#ainv_8c_a158783ba9a4d5687c5fc417acfcc74a4_icgraph" loading="lazy" alt=""/></div>
<map name="ainv_8c_a158783ba9a4d5687c5fc417acfcc74a4_icgraph" id="ainv_8c_a158783ba9a4d5687c5fc417acfcc74a4_icgraph">
<area shape="rect" title="Hall 센서 3개의 상태를 3비트 정수로 변환한다." alt="" coords="483,5,621,32"/>
<area shape="rect" href="inv_8c.html#a3db77525a1b8b485f18baebc7e086cb1" title="Hall 센서 기반 속도/위치 PLL 옵저버" alt="" coords="292,5,435,32"/>
<area shape="poly" title=" " alt="" coords="465,19,436,21,436,16,471,19"/>
<area shape="rect" href="control_8c.html#afb486c446e28753e3dca5112dfdc8264" title="PMSM 메인 제어 함수 (TIM2 인터럽트에서 100µs 주기로 호출)" alt="" coords="181,5,244,32"/>
<area shape="poly" title=" " alt="" coords="274,19,244,21,244,16,279,19"/>
<area shape="rect" href="stm32g4xx__it_8c.html#a38ad4725462bdc5e86c4ead4f04b9fc2" title="TIM2 글로벌 인터럽트 핸들러 ★ 제어 루프 진입점 ★" alt="" coords="5,5,133,32"/>
<area shape="poly" title=" " alt="" coords="162,19,133,21,133,16,168,18"/>
</map>
</div>

</div>
</div>
<a id="a5eb5c4adfd5c3833415678e1da00bf93" name="a5eb5c4adfd5c3833415678e1da00bf93"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5eb5c4adfd5c3833415678e1da00bf93">&#9670;&#160;</a></span>HallPosition_Test()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void HallPosition_Test </td>
          <td>(</td>
          <td class="paramtype">struct INVERTER *</td>          <td class="paramname"><span class="paramname"><em>INV</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Hall 위치 테스트: 기본 전압 벡터를 순차 인가한다. </p>
<p>duty_state 값에 따라 6개 기본 전압 벡터 중 하나를 선택하여 Hall 센서 설치 위치와 극성을 확인하는 데 사용한다.</p>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname"><a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30" title="인버터 전역 상태/파라미터 구조체">INV</a></td><td>인버터 구조체 포인터 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>주의</dt><dd>duty_state 1~6 → 기본 벡터, 그 외 → 영 벡터 </dd></dl>

<p class="definition"><a class="el" href="inv_8c_source.html">inv.c</a> 파일의 <a class="el" href="inv_8c_source.html#l00839">839</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  840</span>{</div>
<div class="line"><span class="lineno">  841</span>    <span class="keywordflow">switch</span> (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;duty_state) {</div>
<div class="line"><span class="lineno">  842</span>        <span class="keywordflow">case</span> 1: <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_A = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_Test; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_B = 0;              <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_C = 0;              <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  843</span>        <span class="keywordflow">case</span> 2: <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_A = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_Test; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_B = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_Test; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_C = 0;              <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  844</span>        <span class="keywordflow">case</span> 3: <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_A = 0;              <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_B = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_Test; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_C = 0;              <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  845</span>        <span class="keywordflow">case</span> 4: <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_A = 0;              <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_B = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_Test; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_C = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_Test; <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  846</span>        <span class="keywordflow">case</span> 5: <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_A = 0;              <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_B = 0;              <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_C = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_Test; <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  847</span>        <span class="keywordflow">case</span> 6: <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_A = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_Test; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_B = 0;              <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_C = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_Test; <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  848</span>        <span class="keywordflow">default</span>:<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_A = 0;              <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_B = 0;              <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_C = 0;              <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  849</span>    }</div>
<div class="line"><span class="lineno">  850</span>}</div>
</div><!-- fragment --><div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="inv_8c_a5eb5c4adfd5c3833415678e1da00bf93_icgraph.png" border="0" usemap="#ainv_8c_a5eb5c4adfd5c3833415678e1da00bf93_icgraph" loading="lazy" alt=""/></div>
<map name="ainv_8c_a5eb5c4adfd5c3833415678e1da00bf93_icgraph" id="ainv_8c_a5eb5c4adfd5c3833415678e1da00bf93_icgraph">
<area shape="rect" title="Hall 위치 테스트: 기본 전압 벡터를 순차 인가한다." alt="" coords="292,5,415,32"/>
<area shape="rect" href="control_8c.html#afb486c446e28753e3dca5112dfdc8264" title="PMSM 메인 제어 함수 (TIM2 인터럽트에서 100µs 주기로 호출)" alt="" coords="181,5,244,32"/>
<area shape="poly" title=" " alt="" coords="274,19,244,21,244,16,279,19"/>
<area shape="rect" href="stm32g4xx__it_8c.html#a38ad4725462bdc5e86c4ead4f04b9fc2" title="TIM2 글로벌 인터럽트 핸들러 ★ 제어 루프 진입점 ★" alt="" coords="5,5,133,32"/>
<area shape="poly" title=" " alt="" coords="162,19,133,21,133,16,168,18"/>
</map>
</div>

</div>
</div>
<a id="a3db77525a1b8b485f18baebc7e086cb1" name="a3db77525a1b8b485f18baebc7e086cb1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3db77525a1b8b485f18baebc7e086cb1">&#9670;&#160;</a></span>Hallsensor_Observer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Hallsensor_Observer </td>
          <td>(</td>
          <td class="paramtype">struct INVERTER *</td>          <td class="paramname"><span class="paramname"><em>INV</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Hall 센서 기반 속도/위치 PLL 옵저버 </p>
<p>Hall 센서 3비트 상태로부터 전기각을 이산적으로 결정하고, PI-PLL을 사용하여 전기각(Thetar_est_Hall)과 전기 각속도(Wr_est_Hall)를 연속적으로 추정한다.</p>
<p>Hall 상태와 전기각 매핑 (0~2π, 60° 간격): </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">hall_state  </th><th class="markdownTableHeadNone">Thetar_Hall_PLL  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">6  </td><td class="markdownTableBodyNone">0  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">4  </td><td class="markdownTableBodyNone">π/3  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">5  </td><td class="markdownTableBodyNone">2π/3  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">π  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3  </td><td class="markdownTableBodyNone">-2π/3  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone">-π/3  </td></tr>
</table>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname"><a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30" title="인버터 전역 상태/파라미터 구조체">INV</a></td><td>인버터 구조체 포인터 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>주의</dt><dd>GPIOC PIN6=hall_a, GPIOC PIN7=hall_b, GPIOD PIN2=hall_c </dd></dl>

<p class="definition"><a class="el" href="inv_8c_source.html">inv.c</a> 파일의 <a class="el" href="inv_8c_source.html#l00781">781</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  782</span>{</div>
<div class="line"><span class="lineno">  783</span>    <span class="comment">/* PLL: 위치 오차로 속도/각도 추정 */</span></div>
<div class="line"><span class="lineno">  784</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_err_Hall = BOUND_PI(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_Hall_PLL - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_est_Hall);</div>
<div class="line"><span class="lineno">  785</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;integ_PLL_Hall += Tsamp * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ki_PLL_Hall * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_err_Hall;</div>
<div class="line"><span class="lineno">  786</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wr_est_Hall     = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kp_PLL_Hall * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_err_Hall + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;integ_PLL_Hall;</div>
<div class="line"><span class="lineno">  787</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_est_Hall += Tsamp * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wr_est_Hall;</div>
<div class="line"><span class="lineno">  788</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_est_Hall  = BOUND_PI(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_est_Hall);</div>
<div class="line"><span class="lineno">  789</span> </div>
<div class="line"><span class="lineno">  790</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wr   = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wr_est_Hall;</div>
<div class="line"><span class="lineno">  791</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrm  = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wr * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;INV_PP;</div>
<div class="line"><span class="lineno">  792</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrm * Rm2Rpm;</div>
<div class="line"><span class="lineno">  793</span> </div>
<div class="line"><span class="lineno">  794</span>    <span class="comment">/* Hall 센서 읽기 */</span></div>
<div class="line"><span class="lineno">  795</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;hall_a = HAL_GPIO_ReadPin(GPIOC, GPIO_PIN_6);</div>
<div class="line"><span class="lineno">  796</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;hall_b = HAL_GPIO_ReadPin(GPIOC, GPIO_PIN_7);</div>
<div class="line"><span class="lineno">  797</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;hall_c = HAL_GPIO_ReadPin(GPIOD, GPIO_PIN_2);</div>
<div class="line"><span class="lineno">  798</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;hall_state = <a class="code hl_function" href="#a158783ba9a4d5687c5fc417acfcc74a4">GetHallSensorState</a>(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;hall_a, <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;hall_b, <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;hall_c);</div>
<div class="line"><span class="lineno">  799</span> </div>
<div class="line"><span class="lineno">  800</span>    <span class="comment">/* Hall 상태 → 전기각 매핑 */</span></div>
<div class="line"><span class="lineno">  801</span>    <span class="keywordflow">switch</span> (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;hall_state) {</div>
<div class="line"><span class="lineno">  802</span>        <span class="keywordflow">case</span> 6: <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_Hall_PLL =  0.f;        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  803</span>        <span class="keywordflow">case</span> 4: <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_Hall_PLL =  PIOF3;      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  804</span>        <span class="keywordflow">case</span> 5: <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_Hall_PLL =  2.f * PIOF3; <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  805</span>        <span class="keywordflow">case</span> 1: <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_Hall_PLL =  3.f * PIOF3; <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  806</span>        <span class="keywordflow">case</span> 3: <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_Hall_PLL = -2.f * PIOF3; <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  807</span>        <span class="keywordflow">case</span> 2: <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_Hall_PLL = -PIOF3;      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  808</span>    }</div>
<div class="line"><span class="lineno">  809</span>}</div>
<div class="ttc" id="ainv_8c_html_a158783ba9a4d5687c5fc417acfcc74a4"><div class="ttname"><a href="#a158783ba9a4d5687c5fc417acfcc74a4">GetHallSensorState</a></div><div class="ttdeci">uint8_t GetHallSensorState(GPIO_PinState hall_sensor_1, GPIO_PinState hall_sensor_2, GPIO_PinState hall_sensor_3)</div><div class="ttdoc">Hall 센서 3개의 상태를 3비트 정수로 변환한다.</div><div class="ttdef"><b>Definition</b> <a href="inv_8c_source.html#l00819">inv.c:819</a></div></div>
</div><!-- fragment --><div class="dynheader">
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="inv_8c_a3db77525a1b8b485f18baebc7e086cb1_cgraph.png" border="0" usemap="#ainv_8c_a3db77525a1b8b485f18baebc7e086cb1_cgraph" loading="lazy" alt=""/></div>
<map name="ainv_8c_a3db77525a1b8b485f18baebc7e086cb1_cgraph" id="ainv_8c_a3db77525a1b8b485f18baebc7e086cb1_cgraph">
<area shape="rect" title="Hall 센서 기반 속도/위치 PLL 옵저버" alt="" coords="5,5,149,32"/>
<area shape="rect" href="inv_8c.html#a158783ba9a4d5687c5fc417acfcc74a4" title="Hall 센서 3개의 상태를 3비트 정수로 변환한다." alt="" coords="197,5,334,32"/>
<area shape="poly" title=" " alt="" coords="149,16,184,19,179,19,149,21"/>
</map>
</div>
<div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="inv_8c_a3db77525a1b8b485f18baebc7e086cb1_icgraph.png" border="0" usemap="#ainv_8c_a3db77525a1b8b485f18baebc7e086cb1_icgraph" loading="lazy" alt=""/></div>
<map name="ainv_8c_a3db77525a1b8b485f18baebc7e086cb1_icgraph" id="ainv_8c_a3db77525a1b8b485f18baebc7e086cb1_icgraph">
<area shape="rect" title="Hall 센서 기반 속도/위치 PLL 옵저버" alt="" coords="292,5,435,32"/>
<area shape="rect" href="control_8c.html#afb486c446e28753e3dca5112dfdc8264" title="PMSM 메인 제어 함수 (TIM2 인터럽트에서 100µs 주기로 호출)" alt="" coords="181,5,244,32"/>
<area shape="poly" title=" " alt="" coords="274,19,244,21,244,16,279,19"/>
<area shape="rect" href="stm32g4xx__it_8c.html#a38ad4725462bdc5e86c4ead4f04b9fc2" title="TIM2 글로벌 인터럽트 핸들러 ★ 제어 루프 진입점 ★" alt="" coords="5,5,133,32"/>
<area shape="poly" title=" " alt="" coords="162,19,133,21,133,16,168,18"/>
</map>
</div>

</div>
</div>
<a id="a887559495f97e26d7fa0ef0a2c5c84f0" name="a887559495f97e26d7fa0ef0a2c5c84f0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a887559495f97e26d7fa0ef0a2c5c84f0">&#9670;&#160;</a></span>Init_Spd_PLL()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Init_Spd_PLL </td>
          <td>(</td>
          <td class="paramtype">struct INVERTER *</td>          <td class="paramname"><span class="paramname"><em>INV</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>Ws</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>속도 PLL(Phase-Locked Loop) 옵저버를 초기화한다. </p>
<p>Hall 센서 또는 사용자 설정 대역폭으로 PLL 게인을 계산한다.</p><ul>
<li>기본 PLL: Kp = 2ζWs, Ki = Ws² (ζ=0.707)</li>
<li>Hall PLL: Kp = 2ζW_Hall, Ki = W_Hall² (W_Hall = 2π×10 rad/s)</li>
</ul>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname"><a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30" title="인버터 전역 상태/파라미터 구조체">INV</a></td><td>인버터 구조체 포인터 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Ws</td><td>PLL 자연 주파수 [rad/s] </td></tr>
  </table>
  </dd>
</dl>

<p class="definition"><a class="el" href="inv_8c_source.html">inv.c</a> 파일의 <a class="el" href="inv_8c_source.html#l00230">230</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  231</span>{</div>
<div class="line"><span class="lineno">  232</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;W_PLL           = Ws;</div>
<div class="line"><span class="lineno">  233</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kp_PLL          = 2.f * 0.707f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;W_PLL;</div>
<div class="line"><span class="lineno">  234</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ki_PLL          = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;W_PLL * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;W_PLL;</div>
<div class="line"><span class="lineno">  235</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;integ_Thetar_PLL = 0.;</div>
<div class="line"><span class="lineno">  236</span> </div>
<div class="line"><span class="lineno">  237</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;W_PLL_Hall      = PI2 * 10.f;</div>
<div class="line"><span class="lineno">  238</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kp_PLL_Hall     = 2.f * 0.707f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;W_PLL_Hall;</div>
<div class="line"><span class="lineno">  239</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ki_PLL_Hall     = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;W_PLL_Hall * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;W_PLL_Hall;</div>
<div class="line"><span class="lineno">  240</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;integ_PLL_Hall  = 0.;</div>
<div class="line"><span class="lineno">  241</span>}</div>
</div><!-- fragment --><div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="inv_8c_a887559495f97e26d7fa0ef0a2c5c84f0_icgraph.png" border="0" usemap="#ainv_8c_a887559495f97e26d7fa0ef0a2c5c84f0_icgraph" loading="lazy" alt=""/></div>
<map name="ainv_8c_a887559495f97e26d7fa0ef0a2c5c84f0_icgraph" id="ainv_8c_a887559495f97e26d7fa0ef0a2c5c84f0_icgraph">
<area shape="rect" title="속도 PLL(Phase&#45;Locked Loop) 옵저버를 초기화한다." alt="" coords="103,5,202,32"/>
<area shape="rect" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe" title="애플리케이션 진입점 (메인 함수)" alt="" coords="5,5,55,32"/>
<area shape="poly" title=" " alt="" coords="85,20,55,21,55,16,90,18"/>
</map>
</div>

</div>
</div>
<a id="a643273242fd423931f39716c68ac91bf" name="a643273242fd423931f39716c68ac91bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a643273242fd423931f39716c68ac91bf">&#9670;&#160;</a></span>InitCurrentController()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void InitCurrentController </td>
          <td>(</td>
          <td class="paramtype">struct INVERTER *</td>          <td class="paramname"><span class="paramname"><em>INV</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>Wcc</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>전류 제어기를 초기화하고 관련 상태 변수를 0으로 리셋한다. </p>
<p>PI 전류 제어기 게인을 대역폭(Wcc)으로 설정한다 (내부 모델 방식):</p><ul>
<li>Kp = Wcc × L</li>
<li>Ki = Wcc × Rs</li>
</ul>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname"><a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30" title="인버터 전역 상태/파라미터 구조체">INV</a></td><td>인버터 구조체 포인터 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Wcc</td><td>전류 제어 대역폭 [rad/s] </td></tr>
  </table>
  </dd>
</dl>

<p class="definition"><a class="el" href="inv_8c_source.html">inv.c</a> 파일의 <a class="el" href="inv_8c_source.html#l00124">124</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  125</span>{</div>
<div class="line"><span class="lineno">  126</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wcc     = Wcc;</div>
<div class="line"><span class="lineno">  127</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kpd_cc  = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wcc * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ld;</div>
<div class="line"><span class="lineno">  128</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kpq_cc  = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wcc * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Lq;</div>
<div class="line"><span class="lineno">  129</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kid_cc  = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wcc * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Rs;</div>
<div class="line"><span class="lineno">  130</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kiq_cc  = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wcc * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Rs;</div>
<div class="line"><span class="lineno">  131</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kad_cc  = 1.f / fmaxf(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kpd_cc, 1.e-9f);</div>
<div class="line"><span class="lineno">  132</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kaq_cc  = 1.f / fmaxf(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kpq_cc, 1.e-9f);</div>
<div class="line"><span class="lineno">  133</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ractive = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Rs;</div>
<div class="line"><span class="lineno">  134</span> </div>
<div class="line"><span class="lineno">  135</span>    <span class="comment">/* 상태 변수 초기화 */</span></div>
<div class="line"><span class="lineno">  136</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idss = 0.; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqss = 0.;</div>
<div class="line"><span class="lineno">  137</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr = 0.; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr = 0.;</div>
<div class="line"><span class="lineno">  138</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_err = 0.; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_err = 0.;</div>
<div class="line"><span class="lineno">  139</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_integ = 0.; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_integ = 0.;</div>
<div class="line"><span class="lineno">  140</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_ff    = 0.; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_ff    = 0.;</div>
<div class="line"><span class="lineno">  141</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_unsat = 0.; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_unsat = 0.;</div>
<div class="line"><span class="lineno">  142</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref = 0.; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref = 0.; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmag_ref = 0.;</div>
<div class="line"><span class="lineno">  143</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_old = 0.; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_old = 0.;</div>
<div class="line"><span class="lineno">  144</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_aw  = 0.; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_aw  = 0.;</div>
<div class="line"><span class="lineno">  145</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdss_ref = 0.; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqss_ref = 0.;</div>
<div class="line"><span class="lineno">  146</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vas_ref = 0.; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbs_ref = 0.; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcs_ref = 0.;</div>
<div class="line"><span class="lineno">  147</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmax = 0.; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmin = 0.; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Voffset = 0.;</div>
<div class="line"><span class="lineno">  148</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Van_ref = 0.; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbn_ref = 0.; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcn_ref = 0.;</div>
<div class="line"><span class="lineno">  149</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_A = 0.; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_B = 0.; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_C = 0.;</div>
<div class="line"><span class="lineno">  150</span> </div>
<div class="line"><span class="lineno">  151</span>    <span class="comment">/* 개루프 제어 변수 초기화 */</span></div>
<div class="line"><span class="lineno">  152</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref_OLC = 0.;</div>
<div class="line"><span class="lineno">  153</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_ref_OLC = 0.;</div>
<div class="line"><span class="lineno">  154</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_OLC = 0.;</div>
<div class="line"><span class="lineno">  155</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_OLC   = 0.;</div>
<div class="line"><span class="lineno">  156</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_OLC_buffer = 0.;</div>
<div class="line"><span class="lineno">  157</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_OLC     = 0.;</div>
<div class="line"><span class="lineno">  158</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_set_OLC = 0.;</div>
<div class="line"><span class="lineno">  159</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_slope_OLC   = 10.f;</div>
<div class="line"><span class="lineno">  160</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_slope_OLC   = 20.f;</div>
<div class="line"><span class="lineno">  161</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref_set_OLC = 0.;</div>
<div class="line"><span class="lineno">  162</span> </div>
<div class="line"><span class="lineno">  163</span>    <span class="comment">/* 비선형 보상(NLC) 변수 초기화 */</span></div>
<div class="line"><span class="lineno">  164</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_NLC = 0.1f;</div>
<div class="line"><span class="lineno">  165</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idss_ref = 0.; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqss_ref = 0.;</div>
<div class="line"><span class="lineno">  166</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ia_ref = 0.; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ib_ref = 0.; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ic_ref = 0.;</div>
<div class="line"><span class="lineno">  167</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;A_NLC = 3.f;</div>
<div class="line"><span class="lineno">  168</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;B_NLC = 4.f;</div>
<div class="line"><span class="lineno">  169</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;C_NLC = 0.;</div>
<div class="line"><span class="lineno">  170</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Va_NLC = 0.; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vb_NLC = 0.; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vc_NLC = 0.;</div>
<div class="line"><span class="lineno">  171</span> </div>
<div class="line"><span class="lineno">  172</span>    <span class="comment">/* 각도 관련 변수 초기화 */</span></div>
<div class="line"><span class="lineno">  173</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar         = 0.;</div>
<div class="line"><span class="lineno">  174</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_adv     = 0.;</div>
<div class="line"><span class="lineno">  175</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_offset  = 0.;</div>
<div class="line"><span class="lineno">  176</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;sinThetar      = 0.;</div>
<div class="line"><span class="lineno">  177</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;cosThetar      = 0.;</div>
<div class="line"><span class="lineno">  178</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;sinThetar_adv  = 0.;</div>
<div class="line"><span class="lineno">  179</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;cosThetar_adv  = 0.;</div>
<div class="line"><span class="lineno">  180</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;init_align_done = 0;</div>
<div class="line"><span class="lineno">  181</span> </div>
<div class="line"><span class="lineno">  182</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;TestDuty_A = 0.f;</div>
<div class="line"><span class="lineno">  183</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;TestDuty_B = 0.f;</div>
<div class="line"><span class="lineno">  184</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;TestDuty_C = 0.f;</div>
<div class="line"><span class="lineno">  185</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_Test  = 0.01f;</div>
<div class="line"><span class="lineno">  186</span>}</div>
</div><!-- fragment --><div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="inv_8c_a643273242fd423931f39716c68ac91bf_icgraph.png" border="0" usemap="#ainv_8c_a643273242fd423931f39716c68ac91bf_icgraph" loading="lazy" alt=""/></div>
<map name="ainv_8c_a643273242fd423931f39716c68ac91bf_icgraph" id="ainv_8c_a643273242fd423931f39716c68ac91bf_icgraph">
<area shape="rect" title="전류 제어기를 초기화하고 관련 상태 변수를 0으로 리셋한다." alt="" coords="103,5,241,32"/>
<area shape="rect" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe" title="애플리케이션 진입점 (메인 함수)" alt="" coords="5,5,55,32"/>
<area shape="poly" title=" " alt="" coords="85,20,55,21,55,16,90,18"/>
</map>
</div>

</div>
</div>
<a id="a917cf2e97121d1990d40ef50799f3ecd" name="a917cf2e97121d1990d40ef50799f3ecd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a917cf2e97121d1990d40ef50799f3ecd">&#9670;&#160;</a></span>InitParameter()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void InitParameter </td>
          <td>(</td>
          <td class="paramtype">struct INVERTER *</td>          <td class="paramname"><span class="paramname"><em>INV</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>Rs</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>Ld</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>Lq</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>Lamf</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>PP</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>Jm</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>Bm</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>Idsr_align</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>Is_rated</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>Is_limit</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>Wrpm_rated</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>Te_rated</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>전동기 및 인버터 기본 파라미터를 초기화한다. </p>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname"><a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30" title="인버터 전역 상태/파라미터 구조체">INV</a></td><td>인버터 구조체 포인터 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Rs</td><td>고정자 저항 [Ω] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Ld</td><td>d축 인덕턴스 [H] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Lq</td><td>q축 인덕턴스 [H] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Lamf</td><td>영구자석 자속 [Wb] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">PP</td><td>극쌍수 [-] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Jm</td><td>관성 모멘트 [kg·m²] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Bm</td><td>점성 마찰 계수 [N·m·s/rad] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Idsr_align</td><td>정렬용 d축 전류 기준값 [A] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Is_rated</td><td>정격 전류 [A] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Is_limit</td><td>최대 허용 전류 [A] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Wrpm_rated</td><td>정격 속도 [rpm] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Te_rated</td><td>정격 토크 [N·m]</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>주의</dt><dd>Kt = 1.5 × PP × Lamf, MTPA 테이블 간격도 내부에서 설정된다. </dd></dl>

<p class="definition"><a class="el" href="inv_8c_source.html">inv.c</a> 파일의 <a class="el" href="inv_8c_source.html#l00083">83</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">   88</span>{</div>
<div class="line"><span class="lineno">   89</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Rs      = Rs;</div>
<div class="line"><span class="lineno">   90</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ld      = Ld;</div>
<div class="line"><span class="lineno">   91</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Lq      = Lq;</div>
<div class="line"><span class="lineno">   92</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ls      = Ld;</div>
<div class="line"><span class="lineno">   93</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Lamf    = Lamf;</div>
<div class="line"><span class="lineno">   94</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;PP      = PP;</div>
<div class="line"><span class="lineno">   95</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;INV_PP  = 1.f / <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;PP;</div>
<div class="line"><span class="lineno">   96</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kt      = 1.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;PP * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Lamf;</div>
<div class="line"><span class="lineno">   97</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;INV_Kt  = 1.f / <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kt;</div>
<div class="line"><span class="lineno">   98</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Jm      = Jm;</div>
<div class="line"><span class="lineno">   99</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;INV_Jm  = 1.f / <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Jm;</div>
<div class="line"><span class="lineno">  100</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Bm      = Bm;</div>
<div class="line"><span class="lineno">  101</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_align = Idsr_align;</div>
<div class="line"><span class="lineno">  102</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Is_rated   = Is_rated;</div>
<div class="line"><span class="lineno">  103</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Is_limit   = Is_limit;</div>
<div class="line"><span class="lineno">  104</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_rated   = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kt * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Is_rated;</div>
<div class="line"><span class="lineno">  105</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_limit   = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kt * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Is_limit;</div>
<div class="line"><span class="lineno">  106</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_rated = Wrpm_rated;</div>
<div class="line"><span class="lineno">  107</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_rated   = Te_rated;</div>
<div class="line"><span class="lineno">  108</span> </div>
<div class="line"><span class="lineno">  109</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;MTPA_Te_gap     = 0.105263157894737f;</div>
<div class="line"><span class="lineno">  110</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;MTPA_Te_max     = 2.f;</div>
<div class="line"><span class="lineno">  111</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;MTPA_Te_gap_INV = 1.f / 0.105263157894737f;</div>
<div class="line"><span class="lineno">  112</span>}</div>
</div><!-- fragment --><div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="inv_8c_a917cf2e97121d1990d40ef50799f3ecd_icgraph.png" border="0" usemap="#ainv_8c_a917cf2e97121d1990d40ef50799f3ecd_icgraph" loading="lazy" alt=""/></div>
<map name="ainv_8c_a917cf2e97121d1990d40ef50799f3ecd_icgraph" id="ainv_8c_a917cf2e97121d1990d40ef50799f3ecd_icgraph">
<area shape="rect" title="전동기 및 인버터 기본 파라미터를 초기화한다." alt="" coords="103,5,202,32"/>
<area shape="rect" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe" title="애플리케이션 진입점 (메인 함수)" alt="" coords="5,5,55,32"/>
<area shape="poly" title=" " alt="" coords="85,20,55,21,55,16,90,18"/>
</map>
</div>

</div>
</div>
<a id="a0e276774794e294c9ba7a8ec91266d75" name="a0e276774794e294c9ba7a8ec91266d75"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0e276774794e294c9ba7a8ec91266d75">&#9670;&#160;</a></span>InitSpeedController()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void InitSpeedController </td>
          <td>(</td>
          <td class="paramtype">struct INVERTER *</td>          <td class="paramname"><span class="paramname"><em>INV</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>Wsc</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>zeta</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>속도 제어기를 초기화하고 관련 상태 변수를 0으로 리셋한다. </p>
<p>PI 속도 제어기 게인을 대역폭(Wsc)으로 설정한다:</p><ul>
<li>Kp = Jm × Wsc</li>
<li>Ki = Kp × Wsc × 0.25</li>
</ul>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname"><a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30" title="인버터 전역 상태/파라미터 구조체">INV</a></td><td>인버터 구조체 포인터 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Wsc</td><td>속도 제어 대역폭 [rad/s] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">zeta</td><td>감쇠비 (현재 미사용, 향후 확장용) </td></tr>
  </table>
  </dd>
</dl>

<p class="definition"><a class="el" href="inv_8c_source.html">inv.c</a> 파일의 <a class="el" href="inv_8c_source.html#l00199">199</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  200</span>{</div>
<div class="line"><span class="lineno">  201</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wsc      = Wsc;</div>
<div class="line"><span class="lineno">  202</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;zeta_sc  = zeta;</div>
<div class="line"><span class="lineno">  203</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kp_sc    = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Jm * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wsc;</div>
<div class="line"><span class="lineno">  204</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ki_scale = 0.25f;</div>
<div class="line"><span class="lineno">  205</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ki_sc    = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kp_sc * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wsc * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ki_scale;</div>
<div class="line"><span class="lineno">  206</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ka_sc    = 1.f / fmaxf(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kp_sc, 1.e-9f);</div>
<div class="line"><span class="lineno">  207</span> </div>
<div class="line"><span class="lineno">  208</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm = 0.; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrm = 0.; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wr = 0.;</div>
<div class="line"><span class="lineno">  209</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_set = 0.; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrm_ref_set = 0.;</div>
<div class="line"><span class="lineno">  210</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref = 0.; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrm_ref = 0.;</div>
<div class="line"><span class="lineno">  211</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;dWrm    = 3000.f * RPM2RM * Tsamp; <span class="comment">/* 가속도 제한: 3000rpm/s */</span></div>
<div class="line"><span class="lineno">  212</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrm_err = 0.;</div>
<div class="line"><span class="lineno">  213</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_ref_integ  = 0.;</div>
<div class="line"><span class="lineno">  214</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_ref_ff     = 0.;</div>
<div class="line"><span class="lineno">  215</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_ref_unsat  = 0.;</div>
<div class="line"><span class="lineno">  216</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_ref        = 0.;</div>
<div class="line"><span class="lineno">  217</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_ref_aw     = 0.;</div>
<div class="line"><span class="lineno">  218</span>}</div>
</div><!-- fragment --><div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="inv_8c_a0e276774794e294c9ba7a8ec91266d75_icgraph.png" border="0" usemap="#ainv_8c_a0e276774794e294c9ba7a8ec91266d75_icgraph" loading="lazy" alt=""/></div>
<map name="ainv_8c_a0e276774794e294c9ba7a8ec91266d75_icgraph" id="ainv_8c_a0e276774794e294c9ba7a8ec91266d75_icgraph">
<area shape="rect" title="속도 제어기를 초기화하고 관련 상태 변수를 0으로 리셋한다." alt="" coords="103,5,235,32"/>
<area shape="rect" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe" title="애플리케이션 진입점 (메인 함수)" alt="" coords="5,5,55,32"/>
<area shape="poly" title=" " alt="" coords="85,20,55,21,55,16,90,18"/>
</map>
</div>

</div>
</div>
<a id="a964ec348ab2be811f76c85501ac14208" name="a964ec348ab2be811f76c85501ac14208"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a964ec348ab2be811f76c85501ac14208">&#9670;&#160;</a></span>OpenLoopControl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void OpenLoopControl </td>
          <td>(</td>
          <td class="paramtype">struct INVERTER *</td>          <td class="paramname"><span class="paramname"><em>INV</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>전류 개루프 제어 (Open-Loop Current Control) </p>
<p>외부에서 설정한 d/q 전류 기준(Idsr_ref_OLC, Iqsr_ref_OLC)과 OLC 각속도(Wrpm_ref_OLC)로 생성한 각도를 사용하여 <a class="el" href="#a68f857bdf76878fd721ac48e6c354997" title="PI 전류 제어기 (d-q 동기 좌표계)">CurrentControl()</a>을 호출한다.</p>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname"><a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30" title="인버터 전역 상태/파라미터 구조체">INV</a></td><td>인버터 구조체 포인터 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>주의</dt><dd><a class="el" href="#a68f857bdf76878fd721ac48e6c354997" title="PI 전류 제어기 (d-q 동기 좌표계)">CurrentControl()</a> 내에서 Theta_mode=1을 통해 OLC 각도가 선택된다. </dd></dl>

<p class="definition"><a class="el" href="inv_8c_source.html">inv.c</a> 파일의 <a class="el" href="inv_8c_source.html#l00503">503</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  504</span>{</div>
<div class="line"><span class="lineno">  505</span>    <span class="comment">/* d축 전류 경사 제한 */</span></div>
<div class="line"><span class="lineno">  506</span>    <span class="keywordflow">if</span>      (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref_set_OLC &gt; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref_OLC + Tsamp * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_slope_OLC)</div>
<div class="line"><span class="lineno">  507</span>             <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref_OLC += Tsamp * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_slope_OLC;</div>
<div class="line"><span class="lineno">  508</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref_set_OLC &lt; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref_OLC - Tsamp * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_slope_OLC)</div>
<div class="line"><span class="lineno">  509</span>             <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref_OLC -= Tsamp * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_slope_OLC;</div>
<div class="line"><span class="lineno">  510</span>    <span class="keywordflow">else</span>     <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref_OLC  = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref_set_OLC;</div>
<div class="line"><span class="lineno">  511</span> </div>
<div class="line"><span class="lineno">  512</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref_OLC;</div>
<div class="line"><span class="lineno">  513</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_ref = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_ref_OLC;</div>
<div class="line"><span class="lineno">  514</span> </div>
<div class="line"><span class="lineno">  515</span>    <span class="comment">/* 속도 경사 제한 */</span></div>
<div class="line"><span class="lineno">  516</span>    <span class="keywordflow">if</span>      (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_set_OLC &gt; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_OLC + Tsamp * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_slope_OLC)</div>
<div class="line"><span class="lineno">  517</span>             <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_OLC += Tsamp * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_slope_OLC;</div>
<div class="line"><span class="lineno">  518</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_set_OLC &lt; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_OLC - Tsamp * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_slope_OLC)</div>
<div class="line"><span class="lineno">  519</span>             <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_OLC -= Tsamp * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_slope_OLC;</div>
<div class="line"><span class="lineno">  520</span>    <span class="keywordflow">else</span>     <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_OLC  = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_set_OLC;</div>
<div class="line"><span class="lineno">  521</span> </div>
<div class="line"><span class="lineno">  522</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_OLC = BOUND_PI(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_OLC + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_OLC * RPM2RM * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;PP * Tsamp);</div>
<div class="line"><span class="lineno">  523</span>}</div>
</div><!-- fragment --><div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="inv_8c_a964ec348ab2be811f76c85501ac14208_icgraph.png" border="0" usemap="#ainv_8c_a964ec348ab2be811f76c85501ac14208_icgraph" loading="lazy" alt=""/></div>
<map name="ainv_8c_a964ec348ab2be811f76c85501ac14208_icgraph" id="ainv_8c_a964ec348ab2be811f76c85501ac14208_icgraph">
<area shape="rect" title="전류 개루프 제어 (Open&#45;Loop Current Control)" alt="" coords="292,5,414,32"/>
<area shape="rect" href="control_8c.html#afb486c446e28753e3dca5112dfdc8264" title="PMSM 메인 제어 함수 (TIM2 인터럽트에서 100µs 주기로 호출)" alt="" coords="181,5,244,32"/>
<area shape="poly" title=" " alt="" coords="274,19,245,21,244,16,279,19"/>
<area shape="rect" href="stm32g4xx__it_8c.html#a38ad4725462bdc5e86c4ead4f04b9fc2" title="TIM2 글로벌 인터럽트 핸들러 ★ 제어 루프 진입점 ★" alt="" coords="5,5,133,32"/>
<area shape="poly" title=" " alt="" coords="162,19,133,21,133,16,168,18"/>
</map>
</div>

</div>
</div>
<a id="a4b849dca1f135dd860c6f0ce88cc7c13" name="a4b849dca1f135dd860c6f0ce88cc7c13"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b849dca1f135dd860c6f0ce88cc7c13">&#9670;&#160;</a></span>PwmDutyUpt()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PwmDutyUpt </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>TIM1 CCR 레지스터에 듀티비를 업데이트한다. </p>
<p>INV.Duty_A/B/C [0,1] 값을 TIM1 ARR(자동 리로드 값)에 곱하여 CCR1~CCR3에 직접 기록한다. </p>

<p class="definition"><a class="el" href="inv_8c_source.html">inv.c</a> 파일의 <a class="el" href="inv_8c_source.html#l00953">953</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  954</span>{</div>
<div class="line"><span class="lineno">  955</span>    <a class="code hl_variable" href="group___t_i_m___handles.html#ga25fc663547539bc49fecc0011bd76ab5">htim1</a>.Instance-&gt;CCR1 = (<span class="keywordtype">unsigned</span> int)(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>.Duty_A * <a class="code hl_variable" href="group___t_i_m___handles.html#ga25fc663547539bc49fecc0011bd76ab5">htim1</a>.Instance-&gt;ARR);</div>
<div class="line"><span class="lineno">  956</span>    <a class="code hl_variable" href="group___t_i_m___handles.html#ga25fc663547539bc49fecc0011bd76ab5">htim1</a>.Instance-&gt;CCR2 = (<span class="keywordtype">unsigned</span> int)(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>.Duty_B * <a class="code hl_variable" href="group___t_i_m___handles.html#ga25fc663547539bc49fecc0011bd76ab5">htim1</a>.Instance-&gt;ARR);</div>
<div class="line"><span class="lineno">  957</span>    <a class="code hl_variable" href="group___t_i_m___handles.html#ga25fc663547539bc49fecc0011bd76ab5">htim1</a>.Instance-&gt;CCR3 = (<span class="keywordtype">unsigned</span> int)(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>.Duty_C * <a class="code hl_variable" href="group___t_i_m___handles.html#ga25fc663547539bc49fecc0011bd76ab5">htim1</a>.Instance-&gt;ARR);</div>
<div class="line"><span class="lineno">  958</span>}</div>
<div class="ttc" id="agroup___t_i_m___handles_html_ga25fc663547539bc49fecc0011bd76ab5"><div class="ttname"><a href="group___t_i_m___handles.html#ga25fc663547539bc49fecc0011bd76ab5">htim1</a></div><div class="ttdeci">TIM_HandleTypeDef htim1</div><div class="ttdoc">TIM1 핸들: 3상 PWM 출력</div><div class="ttdef"><b>Definition</b> <a href="tim_8c_source.html#l00048">tim.c:48</a></div></div>
</div><!-- fragment --><div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="inv_8c_a4b849dca1f135dd860c6f0ce88cc7c13_icgraph.png" border="0" usemap="#ainv_8c_a4b849dca1f135dd860c6f0ce88cc7c13_icgraph" loading="lazy" alt=""/></div>
<map name="ainv_8c_a4b849dca1f135dd860c6f0ce88cc7c13_icgraph" id="ainv_8c_a4b849dca1f135dd860c6f0ce88cc7c13_icgraph">
<area shape="rect" title="TIM1 CCR 레지스터에 듀티비를 업데이트한다." alt="" coords="748,132,848,159"/>
<area shape="rect" href="inv_8c.html#ad14c7779ae276ada8516bc3d58997206" title="d축 전류 정렬 절차 (4단계 상태 머신)" alt="" coords="350,5,400,32"/>
<area shape="poly" title=" " alt="" coords="777,118,744,80,723,61,698,46,659,31,617,21,532,11,456,12,401,17,399,12,456,7,533,6,618,15,661,26,701,42,726,57,748,77,782,120"/>
<area shape="rect" href="control_8c.html#afb486c446e28753e3dca5112dfdc8264" title="PMSM 메인 제어 함수 (TIM2 인터럽트에서 100µs 주기로 호출)" alt="" coords="181,132,244,159"/>
<area shape="poly" title=" " alt="" coords="729,143,535,139,292,141,245,145,244,140,292,136,535,134,734,142"/>
<area shape="rect" href="inv_8c.html#a68f857bdf76878fd721ac48e6c354997" title="PI 전류 제어기 (d&#45;q 동기 좌표계)" alt="" coords="549,56,656,83"/>
<area shape="poly" title=" " alt="" coords="752,125,699,104,648,86,649,81,701,99,757,125"/>
<area shape="rect" href="inv_8c.html#aedf8f86f640274dface77130a3d50207" title="d축 구형파 전압 주입 (파라미터 추정용)" alt="" coords="505,157,700,184"/>
<area shape="poly" title=" " alt="" coords="730,154,701,161,700,155,735,153"/>
<area shape="rect" href="inv_8c.html#aefbd0b8bc957317d7f22f0db0185683d" title="전압 개루프 제어 (Voltage Open&#45;Loop Control)" alt="" coords="292,208,457,235"/>
<area shape="poly" title=" " alt="" coords="766,166,734,186,700,199,638,213,574,221,458,227,458,221,573,216,637,207,699,193,732,181,761,168"/>
<area shape="rect" href="inv_8c.html#a01248186cec9f4dadc54e4c94be940cf" title="전압 기준 생성 제어 (전압 피드포워드 방식)" alt="" coords="316,259,433,285"/>
<area shape="poly" title=" " alt="" coords="778,169,743,203,701,230,632,254,559,268,491,275,434,276,434,271,491,269,559,263,630,249,699,226,740,199,773,171"/>
<area shape="poly" title=" " alt="" coords="332,31,293,53,272,72,252,94,224,133,220,130,248,90,268,68,291,48,337,28"/>
<area shape="rect" href="stm32g4xx__it_8c.html#a38ad4725462bdc5e86c4ead4f04b9fc2" title="TIM2 글로벌 인터럽트 핸들러 ★ 제어 루프 진입점 ★" alt="" coords="5,132,133,159"/>
<area shape="poly" title=" " alt="" coords="162,147,134,148,132,143,167,144"/>
<area shape="poly" title=" " alt="" coords="532,55,400,27,400,21,537,53"/>
<area shape="poly" title=" " alt="" coords="531,69,420,78,355,88,293,104,262,117,235,134,232,129,259,113,291,99,354,83,419,73,536,68"/>
<area shape="poly" title=" " alt="" coords="488,165,244,150,244,145,492,162"/>
<area shape="poly" title=" " alt="" coords="318,202,291,192,236,162,237,157,293,187,323,202"/>
<area shape="poly" title=" " alt="" coords="299,252,290,249,266,228,246,204,220,162,222,157,250,201,270,224,294,245,305,253"/>
</map>
</div>

</div>
</div>
<a id="a9013a288bba48367bf9d57702c80b1ee" name="a9013a288bba48367bf9d57702c80b1ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9013a288bba48367bf9d57702c80b1ee">&#9670;&#160;</a></span>PwmSwOff()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PwmSwOff </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>TIM1 PWM 출력을 비활성화한다. </p>
<p>고장 발생 또는 정지 시 호출된다. PWM 버퍼를 먼저 끄고 듀티를 0으로 설정한 뒤 모든 채널을 정지한다.</p>
<dl class="section warning"><dt>경고</dt><dd>이 함수 호출 즉시 인버터 출력이 차단된다. </dd></dl>

<p class="definition"><a class="el" href="inv_8c_source.html">inv.c</a> 파일의 <a class="el" href="inv_8c_source.html#l00932">932</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  933</span>{</div>
<div class="line"><span class="lineno">  934</span>    PWM_BUF_OFF;</div>
<div class="line"><span class="lineno">  935</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>.Duty_A = 0.f;</div>
<div class="line"><span class="lineno">  936</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>.Duty_B = 0.f;</div>
<div class="line"><span class="lineno">  937</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>.Duty_C = 0.f;</div>
<div class="line"><span class="lineno">  938</span> </div>
<div class="line"><span class="lineno">  939</span>    HAL_TIM_PWM_Stop(&amp;<a class="code hl_variable" href="group___t_i_m___handles.html#ga25fc663547539bc49fecc0011bd76ab5">htim1</a>, TIM_CHANNEL_1);</div>
<div class="line"><span class="lineno">  940</span>    HAL_TIMEx_PWMN_Stop(&amp;<a class="code hl_variable" href="group___t_i_m___handles.html#ga25fc663547539bc49fecc0011bd76ab5">htim1</a>, TIM_CHANNEL_1);</div>
<div class="line"><span class="lineno">  941</span>    HAL_TIM_PWM_Stop(&amp;<a class="code hl_variable" href="group___t_i_m___handles.html#ga25fc663547539bc49fecc0011bd76ab5">htim1</a>, TIM_CHANNEL_2);</div>
<div class="line"><span class="lineno">  942</span>    HAL_TIMEx_PWMN_Stop(&amp;<a class="code hl_variable" href="group___t_i_m___handles.html#ga25fc663547539bc49fecc0011bd76ab5">htim1</a>, TIM_CHANNEL_2);</div>
<div class="line"><span class="lineno">  943</span>    HAL_TIM_PWM_Stop(&amp;<a class="code hl_variable" href="group___t_i_m___handles.html#ga25fc663547539bc49fecc0011bd76ab5">htim1</a>, TIM_CHANNEL_3);</div>
<div class="line"><span class="lineno">  944</span>    HAL_TIMEx_PWMN_Stop(&amp;<a class="code hl_variable" href="group___t_i_m___handles.html#ga25fc663547539bc49fecc0011bd76ab5">htim1</a>, TIM_CHANNEL_3);</div>
<div class="line"><span class="lineno">  945</span>}</div>
</div><!-- fragment --><div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="inv_8c_a9013a288bba48367bf9d57702c80b1ee_icgraph.png" border="0" usemap="#ainv_8c_a9013a288bba48367bf9d57702c80b1ee_icgraph" loading="lazy" alt=""/></div>
<map name="ainv_8c_a9013a288bba48367bf9d57702c80b1ee_icgraph" id="ainv_8c_a9013a288bba48367bf9d57702c80b1ee_icgraph">
<area shape="rect" title="TIM1 PWM 출력을 비활성화한다." alt="" coords="567,56,655,83"/>
<area shape="rect" href="control_8c.html#afb486c446e28753e3dca5112dfdc8264" title="PMSM 메인 제어 함수 (TIM2 인터럽트에서 100µs 주기로 호출)" alt="" coords="240,5,304,32"/>
<area shape="poly" title=" " alt="" coords="577,47,550,33,519,21,460,11,401,9,305,16,304,11,401,4,461,6,520,16,552,28,582,47"/>
<area shape="rect" href="fault_8c.html#a0cd91fd3a9608559c2a87a8ba6cba55f" title="GPIO 외부 인터럽트 콜백 (하드웨어 고장 진입점)" alt="" coords="181,107,363,133"/>
<area shape="poly" title=" " alt="" coords="555,78,364,109,363,104,550,78"/>
<area shape="rect" href="fault_8c.html#a9e792a029e400717c2f3bde3b10624dc" title="하드웨어 고장 처리 함수" alt="" coords="411,132,519,159"/>
<area shape="poly" title=" " alt="" coords="573,90,493,134,492,129,567,91"/>
<area shape="rect" href="fault_8c.html#a5d0d662228c78364b02259814f0f8ccd" title="소프트웨어 고장 처리 함수" alt="" coords="413,31,517,57"/>
<area shape="poly" title=" " alt="" coords="549,59,517,56,518,50,554,59"/>
<area shape="rect" href="stm32g4xx__it_8c.html#a38ad4725462bdc5e86c4ead4f04b9fc2" title="TIM2 글로벌 인터럽트 핸들러 ★ 제어 루프 진입점 ★" alt="" coords="5,5,133,32"/>
<area shape="poly" title=" " alt="" coords="223,20,134,21,133,16,227,17"/>
<area shape="poly" title=" " alt="" coords="393,136,363,135,364,129,398,136"/>
<area shape="poly" title=" " alt="" coords="395,36,304,25,304,20,400,35"/>
</map>
</div>

</div>
</div>
<a id="a031511fea69b8fce19a44f86eb1858fe" name="a031511fea69b8fce19a44f86eb1858fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a031511fea69b8fce19a44f86eb1858fe">&#9670;&#160;</a></span>PwmSwOn()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PwmSwOn </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>TIM1 PWM 출력을 활성화한다 (3상 상하 암 모두). </p>
<p>CH1~CH3 및 보완 채널(CH1N~CH3N)을 모두 시작한다. </p>

<p class="definition"><a class="el" href="inv_8c_source.html">inv.c</a> 파일의 <a class="el" href="inv_8c_source.html#l00914">914</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  915</span>{</div>
<div class="line"><span class="lineno">  916</span>    HAL_TIM_PWM_Start(&amp;<a class="code hl_variable" href="group___t_i_m___handles.html#ga25fc663547539bc49fecc0011bd76ab5">htim1</a>, TIM_CHANNEL_1);</div>
<div class="line"><span class="lineno">  917</span>    HAL_TIMEx_PWMN_Start(&amp;<a class="code hl_variable" href="group___t_i_m___handles.html#ga25fc663547539bc49fecc0011bd76ab5">htim1</a>, TIM_CHANNEL_1);</div>
<div class="line"><span class="lineno">  918</span>    HAL_TIM_PWM_Start(&amp;<a class="code hl_variable" href="group___t_i_m___handles.html#ga25fc663547539bc49fecc0011bd76ab5">htim1</a>, TIM_CHANNEL_2);</div>
<div class="line"><span class="lineno">  919</span>    HAL_TIMEx_PWMN_Start(&amp;<a class="code hl_variable" href="group___t_i_m___handles.html#ga25fc663547539bc49fecc0011bd76ab5">htim1</a>, TIM_CHANNEL_2);</div>
<div class="line"><span class="lineno">  920</span>    HAL_TIM_PWM_Start(&amp;<a class="code hl_variable" href="group___t_i_m___handles.html#ga25fc663547539bc49fecc0011bd76ab5">htim1</a>, TIM_CHANNEL_3);</div>
<div class="line"><span class="lineno">  921</span>    HAL_TIMEx_PWMN_Start(&amp;<a class="code hl_variable" href="group___t_i_m___handles.html#ga25fc663547539bc49fecc0011bd76ab5">htim1</a>, TIM_CHANNEL_3);</div>
<div class="line"><span class="lineno">  922</span>}</div>
</div><!-- fragment --><div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="inv_8c_a031511fea69b8fce19a44f86eb1858fe_icgraph.png" border="0" usemap="#ainv_8c_a031511fea69b8fce19a44f86eb1858fe_icgraph" loading="lazy" alt=""/></div>
<map name="ainv_8c_a031511fea69b8fce19a44f86eb1858fe_icgraph" id="ainv_8c_a031511fea69b8fce19a44f86eb1858fe_icgraph">
<area shape="rect" title="TIM1 PWM 출력을 활성화한다 (3상 상하 암 모두)." alt="" coords="748,132,835,159"/>
<area shape="rect" href="inv_8c.html#ad14c7779ae276ada8516bc3d58997206" title="d축 전류 정렬 절차 (4단계 상태 머신)" alt="" coords="350,5,400,32"/>
<area shape="poly" title=" " alt="" coords="772,118,742,80,721,61,698,46,659,30,617,20,533,10,457,12,401,17,400,12,456,6,533,5,618,14,661,25,701,42,725,57,746,77,777,119"/>
<area shape="rect" href="control_8c.html#afb486c446e28753e3dca5112dfdc8264" title="PMSM 메인 제어 함수 (TIM2 인터럽트에서 100µs 주기로 호출)" alt="" coords="181,132,244,159"/>
<area shape="poly" title=" " alt="" coords="730,143,537,139,415,138,292,141,245,145,244,140,292,136,415,133,537,134,735,142"/>
<area shape="rect" href="inv_8c.html#a68f857bdf76878fd721ac48e6c354997" title="PI 전류 제어기 (d&#45;q 동기 좌표계)" alt="" coords="549,56,656,83"/>
<area shape="poly" title=" " alt="" coords="748,125,699,104,649,86,650,81,701,99,753,125"/>
<area shape="rect" href="inv_8c.html#aedf8f86f640274dface77130a3d50207" title="d축 구형파 전압 주입 (파라미터 추정용)" alt="" coords="505,157,700,184"/>
<area shape="poly" title=" " alt="" coords="730,154,701,160,700,155,735,153"/>
<area shape="rect" href="inv_8c.html#aefbd0b8bc957317d7f22f0db0185683d" title="전압 개루프 제어 (Voltage Open&#45;Loop Control)" alt="" coords="292,208,457,235"/>
<area shape="poly" title=" " alt="" coords="761,167,732,186,700,199,638,213,574,222,458,227,458,222,574,217,637,208,699,193,729,181,756,168"/>
<area shape="rect" href="inv_8c.html#a01248186cec9f4dadc54e4c94be940cf" title="전압 기준 생성 제어 (전압 피드포워드 방식)" alt="" coords="316,259,433,285"/>
<area shape="poly" title=" " alt="" coords="773,169,741,204,701,232,632,256,560,270,492,276,434,277,434,272,491,271,559,265,631,251,698,227,738,200,768,172"/>
<area shape="poly" title=" " alt="" coords="332,31,293,53,272,72,252,94,224,133,220,130,248,90,268,68,291,48,337,28"/>
<area shape="rect" href="stm32g4xx__it_8c.html#a38ad4725462bdc5e86c4ead4f04b9fc2" title="TIM2 글로벌 인터럽트 핸들러 ★ 제어 루프 진입점 ★" alt="" coords="5,132,133,159"/>
<area shape="poly" title=" " alt="" coords="162,147,134,148,132,143,167,144"/>
<area shape="poly" title=" " alt="" coords="532,55,400,27,400,21,537,53"/>
<area shape="poly" title=" " alt="" coords="531,69,420,78,355,88,293,104,262,117,235,134,232,129,259,113,291,99,354,83,419,73,536,68"/>
<area shape="poly" title=" " alt="" coords="488,165,244,150,244,145,492,162"/>
<area shape="poly" title=" " alt="" coords="318,202,291,192,236,162,237,157,293,187,323,202"/>
<area shape="poly" title=" " alt="" coords="299,252,290,249,266,228,246,204,220,162,222,157,250,201,270,224,294,245,305,253"/>
</map>
</div>

</div>
</div>
<a id="a1f6df58c2a073ad2274f97f6a504c96d" name="a1f6df58c2a073ad2274f97f6a504c96d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f6df58c2a073ad2274f97f6a504c96d">&#9670;&#160;</a></span>ResetController()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ResetController </td>
          <td>(</td>
          <td class="paramtype">struct INVERTER *</td>          <td class="paramname"><span class="paramname"><em>INV</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>모든 제어 상태 변수를 초기값으로 리셋한다. </p>
<p>고장 발생, 운전 정지, 모드 전환 시 호출하여 적분기 등 내부 상태를 초기화한다.</p>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname"><a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30" title="인버터 전역 상태/파라미터 구조체">INV</a></td><td>인버터 구조체 포인터 </td></tr>
  </table>
  </dd>
</dl>

<p class="definition"><a class="el" href="inv_8c_source.html">inv.c</a> 파일의 <a class="el" href="inv_8c_source.html#l00274">274</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  275</span>{</div>
<div class="line"><span class="lineno">  276</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrm_ref_set      = 0.;</div>
<div class="line"><span class="lineno">  277</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_set     = 0.;</div>
<div class="line"><span class="lineno">  278</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_set_old = 0.;</div>
<div class="line"><span class="lineno">  279</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrm_ref          = 0.;</div>
<div class="line"><span class="lineno">  280</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref         = 0.;</div>
<div class="line"><span class="lineno">  281</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_ref_integ     = 0.;</div>
<div class="line"><span class="lineno">  282</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_ref_aw        = 0.;</div>
<div class="line"><span class="lineno">  283</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref_integ   = 0.;</div>
<div class="line"><span class="lineno">  284</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref_aw      = 0.;</div>
<div class="line"><span class="lineno">  285</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_ref_sat       = 0.;</div>
<div class="line"><span class="lineno">  286</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_ref           = 0.;</div>
<div class="line"><span class="lineno">  287</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref         = 0.;</div>
<div class="line"><span class="lineno">  288</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_ref         = 0.;</div>
<div class="line"><span class="lineno">  289</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref_OLC     = 0.;</div>
<div class="line"><span class="lineno">  290</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_ref_OLC     = 0.;</div>
<div class="line"><span class="lineno">  291</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_OLC     = 0.;</div>
<div class="line"><span class="lineno">  292</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_OLC     = 0.;</div>
<div class="line"><span class="lineno">  293</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_OLC       = 0.;</div>
<div class="line"><span class="lineno">  294</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_OLC     = 0.;</div>
<div class="line"><span class="lineno">  295</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_set_OLC = 0.;</div>
<div class="line"><span class="lineno">  296</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_slope_OLC   = 5.f;</div>
<div class="line"><span class="lineno">  297</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_integ   = 0.;</div>
<div class="line"><span class="lineno">  298</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_integ   = 0.;</div>
<div class="line"><span class="lineno">  299</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_unsat   = 0;</div>
<div class="line"><span class="lineno">  300</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_unsat   = 0;</div>
<div class="line"><span class="lineno">  301</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_aw      = 0.;</div>
<div class="line"><span class="lineno">  302</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_aw      = 0.;</div>
<div class="line"><span class="lineno">  303</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;TestDuty_A       = 0.;</div>
<div class="line"><span class="lineno">  304</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;TestDuty_B       = 0.;</div>
<div class="line"><span class="lineno">  305</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;TestDuty_C       = 0.;</div>
<div class="line"><span class="lineno">  306</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;alpha_LPF        = 0;</div>
<div class="line"><span class="lineno">  307</span>}</div>
</div><!-- fragment --><div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="inv_8c_a1f6df58c2a073ad2274f97f6a504c96d_icgraph.png" border="0" usemap="#ainv_8c_a1f6df58c2a073ad2274f97f6a504c96d_icgraph" loading="lazy" alt=""/></div>
<map name="ainv_8c_a1f6df58c2a073ad2274f97f6a504c96d_icgraph" id="ainv_8c_a1f6df58c2a073ad2274f97f6a504c96d_icgraph">
<area shape="rect" title="모든 제어 상태 변수를 초기값으로 리셋한다." alt="" coords="292,5,404,32"/>
<area shape="rect" href="control_8c.html#afb486c446e28753e3dca5112dfdc8264" title="PMSM 메인 제어 함수 (TIM2 인터럽트에서 100µs 주기로 호출)" alt="" coords="181,5,244,32"/>
<area shape="poly" title=" " alt="" coords="274,19,245,21,245,16,279,19"/>
<area shape="rect" href="stm32g4xx__it_8c.html#a38ad4725462bdc5e86c4ead4f04b9fc2" title="TIM2 글로벌 인터럽트 핸들러 ★ 제어 루프 진입점 ★" alt="" coords="5,5,133,32"/>
<area shape="poly" title=" " alt="" coords="162,19,133,21,133,16,168,18"/>
</map>
</div>

</div>
</div>
<a id="aa0c62359efaad04d667cc7d8d3e169e6" name="aa0c62359efaad04d667cc7d8d3e169e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa0c62359efaad04d667cc7d8d3e169e6">&#9670;&#160;</a></span>SpeedControl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SpeedControl </td>
          <td>(</td>
          <td class="paramtype">struct INVERTER *</td>          <td class="paramname"><span class="paramname"><em>INV</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>PI 속도 제어기 (rpm → 토크 기준 생성) </p>
<p>속도 기준(Wrpm_ref_set)을 경사 제한(dWrm)하여 Wrm_ref를 생성하고, 속도 오차에 PI 제어를 적용하여 Te_ref를 출력한다.</p>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname"><a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30" title="인버터 전역 상태/파라미터 구조체">INV</a></td><td>인버터 구조체 포인터 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>주의</dt><dd>데드존: |Wrpm_ref_set| &lt; 5% × Wrpm_rated → Wrpm_ref_set = 0 </dd></dl>

<p class="definition"><a class="el" href="inv_8c_source.html">inv.c</a> 파일의 <a class="el" href="inv_8c_source.html#l00473">473</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  474</span>{</div>
<div class="line"><span class="lineno">  475</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_set = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_cmd;</div>
<div class="line"><span class="lineno">  476</span>    <span class="keywordflow">if</span> (ABS(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_set) &lt; 0.05f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_rated) <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_set = 0.;</div>
<div class="line"><span class="lineno">  477</span> </div>
<div class="line"><span class="lineno">  478</span>    <span class="comment">/* 속도 경사 제한 */</span></div>
<div class="line"><span class="lineno">  479</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrm_ref_set = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_set * RPM2RM;</div>
<div class="line"><span class="lineno">  480</span>    <span class="keywordflow">if</span>      (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrm_ref &lt; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrm_ref_set - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;dWrm) <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrm_ref += <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;dWrm;</div>
<div class="line"><span class="lineno">  481</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrm_ref &gt; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrm_ref_set + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;dWrm) <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrm_ref -= <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;dWrm;</div>
<div class="line"><span class="lineno">  482</span>    <span class="keywordflow">else</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrm_ref = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrm_ref_set;</div>
<div class="line"><span class="lineno">  483</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrm_ref * RM2RPM;</div>
<div class="line"><span class="lineno">  484</span> </div>
<div class="line"><span class="lineno">  485</span>    <span class="comment">/* PI 속도 제어 (Anti-windup 포함) */</span></div>
<div class="line"><span class="lineno">  486</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrm_err = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrm_ref - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrm;</div>
<div class="line"><span class="lineno">  487</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_ref_integ += <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ki_sc * (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrm_err - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ka_sc * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_ref_aw) * Tsamp;</div>
<div class="line"><span class="lineno">  488</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_ref_unsat  = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kp_sc * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrm_err + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_ref_integ;</div>
<div class="line"><span class="lineno">  489</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_ref        = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_ref_unsat, -<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_rated, <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_rated);</div>
<div class="line"><span class="lineno">  490</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_ref_aw     = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_ref_unsat - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_ref;</div>
<div class="line"><span class="lineno">  491</span>}</div>
</div><!-- fragment --><div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="inv_8c_aa0c62359efaad04d667cc7d8d3e169e6_icgraph.png" border="0" usemap="#ainv_8c_aa0c62359efaad04d667cc7d8d3e169e6_icgraph" loading="lazy" alt=""/></div>
<map name="ainv_8c_aa0c62359efaad04d667cc7d8d3e169e6_icgraph" id="ainv_8c_aa0c62359efaad04d667cc7d8d3e169e6_icgraph">
<area shape="rect" title="PI 속도 제어기 (rpm → 토크 기준 생성)" alt="" coords="292,5,392,32"/>
<area shape="rect" href="control_8c.html#afb486c446e28753e3dca5112dfdc8264" title="PMSM 메인 제어 함수 (TIM2 인터럽트에서 100µs 주기로 호출)" alt="" coords="181,5,244,32"/>
<area shape="poly" title=" " alt="" coords="274,19,244,21,244,16,279,19"/>
<area shape="rect" href="stm32g4xx__it_8c.html#a38ad4725462bdc5e86c4ead4f04b9fc2" title="TIM2 글로벌 인터럽트 핸들러 ★ 제어 루프 진입점 ★" alt="" coords="5,5,133,32"/>
<area shape="poly" title=" " alt="" coords="162,19,133,21,133,16,168,18"/>
</map>
</div>

</div>
</div>
<a id="a7c9cfee082f7d95396b41b6fd5b0676d" name="a7c9cfee082f7d95396b41b6fd5b0676d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c9cfee082f7d95396b41b6fd5b0676d">&#9670;&#160;</a></span>TorqueControl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TorqueControl </td>
          <td>(</td>
          <td class="paramtype">struct INVERTER *</td>          <td class="paramname"><span class="paramname"><em>INV</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>토크 제어 함수 (듀티 사이클 기반 토크 기준 생성) </p>
<p>외부 입력(dutyCycle)으로부터 토크 기준을 생성하고 q축 전류 기준만 사용하는 단순 토크 제어를 수행한다. (Id=0 제어, MTPA 미적용)</p>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname"><a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30" title="인버터 전역 상태/파라미터 구조체">INV</a></td><td>인버터 구조체 포인터 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>주의</dt><dd>데드존: |Te_ref| &lt; 5% × Te_rated → Te_ref = 0 </dd></dl>

<p class="definition"><a class="el" href="inv_8c_source.html">inv.c</a> 파일의 <a class="el" href="inv_8c_source.html#l00323">323</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  324</span>{</div>
<div class="line"><span class="lineno">  325</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_ref = (<a class="code hl_variable" href="#ab5e71ba0276929fe061bacdcc22c3335">dutyCycle</a> - 0.15f) * 20.f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_rated;</div>
<div class="line"><span class="lineno">  326</span> </div>
<div class="line"><span class="lineno">  327</span>    <span class="keywordflow">if</span> (ABS(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_ref) &lt; 0.05f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_rated) <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_ref = 0.f;</div>
<div class="line"><span class="lineno">  328</span> </div>
<div class="line"><span class="lineno">  329</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref        = 0.f;</div>
<div class="line"><span class="lineno">  330</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_ref_unsat  = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;INV_Kt;</div>
<div class="line"><span class="lineno">  331</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_max        = sqrtf(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Is_limit * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Is_limit - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref);</div>
<div class="line"><span class="lineno">  332</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_ref        = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_ref_unsat, -<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_max, <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_max);</div>
<div class="line"><span class="lineno">  333</span>}</div>
<div class="ttc" id="ainv_8c_html_ab5e71ba0276929fe061bacdcc22c3335"><div class="ttname"><a href="#ab5e71ba0276929fe061bacdcc22c3335">dutyCycle</a></div><div class="ttdeci">float dutyCycle</div><div class="ttdoc">RC 수신기 입력 듀티 사이클 값 [0.0, 1.0]</div><div class="ttdef"><b>Definition</b> <a href="main_8c_source.html#l00056">main.c:56</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9fabfabf3cf816a557870ac6174ba05b" name="a9fabfabf3cf816a557870ac6174ba05b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9fabfabf3cf816a557870ac6174ba05b">&#9670;&#160;</a></span>UpdateController()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UpdateController </td>
          <td>(</td>
          <td class="paramtype">struct INVERTER *</td>          <td class="paramname"><span class="paramname"><em>INV</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>제어기 게인을 현재 파라미터로 갱신한다. </p>
<p>실시간으로 Rs, Ld, Lq, Wcc, Wsc가 변경되었을 때 호출하여 전류/속도 제어기 게인을 재계산한다. 매 샘플링마다 <a class="el" href="control_8c.html#afb486c446e28753e3dca5112dfdc8264" title="PMSM 메인 제어 함수 (TIM2 인터럽트에서 100µs 주기로 호출)">Control()</a>에서 호출된다.</p>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname"><a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30" title="인버터 전역 상태/파라미터 구조체">INV</a></td><td>인버터 구조체 포인터 </td></tr>
  </table>
  </dd>
</dl>

<p class="definition"><a class="el" href="inv_8c_source.html">inv.c</a> 파일의 <a class="el" href="inv_8c_source.html#l00251">251</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  252</span>{</div>
<div class="line"><span class="lineno">  253</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kpd_cc = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wcc * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ld;</div>
<div class="line"><span class="lineno">  254</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kpq_cc = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wcc * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Lq;</div>
<div class="line"><span class="lineno">  255</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kid_cc = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wcc * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Rs;</div>
<div class="line"><span class="lineno">  256</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kiq_cc = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wcc * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Rs;</div>
<div class="line"><span class="lineno">  257</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kad_cc = 1.f / fmaxf(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kpd_cc, 1.e-9f);</div>
<div class="line"><span class="lineno">  258</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kaq_cc = 1.f / fmaxf(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kpq_cc, 1.e-9f);</div>
<div class="line"><span class="lineno">  259</span> </div>
<div class="line"><span class="lineno">  260</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kp_sc   = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Jm * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wsc;</div>
<div class="line"><span class="lineno">  261</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ki_scale = 0.25f;</div>
<div class="line"><span class="lineno">  262</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ki_sc   = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kp_sc * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wsc * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ki_scale;</div>
<div class="line"><span class="lineno">  263</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ka_sc   = 1.f / fmaxf(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Kp_sc, 1.e-9f);</div>
<div class="line"><span class="lineno">  264</span>}</div>
</div><!-- fragment --><div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="inv_8c_a9fabfabf3cf816a557870ac6174ba05b_icgraph.png" border="0" usemap="#ainv_8c_a9fabfabf3cf816a557870ac6174ba05b_icgraph" loading="lazy" alt=""/></div>
<map name="ainv_8c_a9fabfabf3cf816a557870ac6174ba05b_icgraph" id="ainv_8c_a9fabfabf3cf816a557870ac6174ba05b_icgraph">
<area shape="rect" title="제어기 게인을 현재 파라미터로 갱신한다." alt="" coords="292,5,411,32"/>
<area shape="rect" href="control_8c.html#afb486c446e28753e3dca5112dfdc8264" title="PMSM 메인 제어 함수 (TIM2 인터럽트에서 100µs 주기로 호출)" alt="" coords="181,5,244,32"/>
<area shape="poly" title=" " alt="" coords="274,19,245,21,244,16,279,19"/>
<area shape="rect" href="stm32g4xx__it_8c.html#a38ad4725462bdc5e86c4ead4f04b9fc2" title="TIM2 글로벌 인터럽트 핸들러 ★ 제어 루프 진입점 ★" alt="" coords="5,5,133,32"/>
<area shape="poly" title=" " alt="" coords="162,19,133,21,133,16,168,18"/>
</map>
</div>

</div>
</div>
<a id="aedf8f86f640274dface77130a3d50207" name="aedf8f86f640274dface77130a3d50207"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aedf8f86f640274dface77130a3d50207">&#9670;&#160;</a></span>VoltageInjection_SquareWave()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void VoltageInjection_SquareWave </td>
          <td>(</td>
          <td class="paramtype">struct INVERTER *</td>          <td class="paramname"><span class="paramname"><em>INV</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>d축 구형파 전압 주입 (파라미터 추정용) </p>
<p>매 제어 주기마다 d축 전압을 ±Vmag_inj로 토글하여 주입한다. 인덕턴스, 저항 등 파라미터 추정에 사용된다.</p>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname"><a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30" title="인버터 전역 상태/파라미터 구조체">INV</a></td><td>인버터 구조체 포인터 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>주의</dt><dd>주입 방향: cnt_inj≥2 → +d주입, cnt_inj&lt;2 → -d주입 (2주기 토글) </dd></dl>

<p class="definition"><a class="el" href="inv_8c_source.html">inv.c</a> 파일의 <a class="el" href="inv_8c_source.html#l00694">694</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  695</span>{</div>
<div class="line"><span class="lineno">  696</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmag_inj = 1;</div>
<div class="line"><span class="lineno">  697</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar   = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_OLC;</div>
<div class="line"><span class="lineno">  698</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_adv    = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_OLC;</div>
<div class="line"><span class="lineno">  699</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;cosThetar     = 1;</div>
<div class="line"><span class="lineno">  700</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;sinThetar     = 0;</div>
<div class="line"><span class="lineno">  701</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;cosThetar_adv = 1;</div>
<div class="line"><span class="lineno">  702</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;sinThetar_adv = 0;</div>
<div class="line"><span class="lineno">  703</span> </div>
<div class="line"><span class="lineno">  704</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#adc9491aaf3043e1e99f084debf0bd167">cnt_inj</a> &gt;= 2) {</div>
<div class="line"><span class="lineno">  705</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_unsat = +<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmag_inj; <span class="comment">/* +d 주입 */</span></div>
<div class="line"><span class="lineno">  706</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_unsat =  0;</div>
<div class="line"><span class="lineno">  707</span>        <a class="code hl_variable" href="#adc9491aaf3043e1e99f084debf0bd167">cnt_inj</a> = 0;</div>
<div class="line"><span class="lineno">  708</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  709</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_unsat = -<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmag_inj; <span class="comment">/* -d 주입 */</span></div>
<div class="line"><span class="lineno">  710</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_unsat =  0;</div>
<div class="line"><span class="lineno">  711</span>        <a class="code hl_variable" href="#adc9491aaf3043e1e99f084debf0bd167">cnt_inj</a> = 1;</div>
<div class="line"><span class="lineno">  712</span>    }</div>
<div class="line"><span class="lineno">  713</span>    <a class="code hl_variable" href="#adc9491aaf3043e1e99f084debf0bd167">cnt_inj</a>++;</div>
<div class="line"><span class="lineno">  714</span> </div>
<div class="line"><span class="lineno">  715</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_unsat, -<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc * INV_SQRT3, <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc * INV_SQRT3);</div>
<div class="line"><span class="lineno">  716</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_unsat, -<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc * INV_SQRT3, <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc * INV_SQRT3);</div>
<div class="line"><span class="lineno">  717</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_aw  = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_unsat - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref;</div>
<div class="line"><span class="lineno">  718</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_aw  = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_unsat - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref;</div>
<div class="line"><span class="lineno">  719</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdss_ref = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;cosThetar_adv - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;sinThetar_adv;</div>
<div class="line"><span class="lineno">  720</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqss_ref = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;sinThetar_adv + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;cosThetar_adv;</div>
<div class="line"><span class="lineno">  721</span> </div>
<div class="line"><span class="lineno">  722</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vas_ref = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdss_ref;</div>
<div class="line"><span class="lineno">  723</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbs_ref = -0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdss_ref + SQRT3HALF * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqss_ref;</div>
<div class="line"><span class="lineno">  724</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcs_ref = -0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdss_ref - SQRT3HALF * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqss_ref;</div>
<div class="line"><span class="lineno">  725</span> </div>
<div class="line"><span class="lineno">  726</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmax = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vas_ref;</div>
<div class="line"><span class="lineno">  727</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmax &lt; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbs_ref) <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmax = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbs_ref;</div>
<div class="line"><span class="lineno">  728</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmax &lt; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcs_ref) <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmax = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcs_ref;</div>
<div class="line"><span class="lineno">  729</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmin = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vas_ref;</div>
<div class="line"><span class="lineno">  730</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmin &gt; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbs_ref) <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmin = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbs_ref;</div>
<div class="line"><span class="lineno">  731</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmin &gt; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcs_ref) <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmin = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcs_ref;</div>
<div class="line"><span class="lineno">  732</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Voffset = -0.5f * (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmax + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmin);</div>
<div class="line"><span class="lineno">  733</span> </div>
<div class="line"><span class="lineno">  734</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idss_ref = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;cosThetar_adv - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;sinThetar_adv;</div>
<div class="line"><span class="lineno">  735</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqss_ref = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;sinThetar_adv + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;cosThetar_adv;</div>
<div class="line"><span class="lineno">  736</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ia_ref = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idss_ref;</div>
<div class="line"><span class="lineno">  737</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ib_ref = -0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idss_ref + SQRT3HALF * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqss_ref;</div>
<div class="line"><span class="lineno">  738</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ic_ref = -0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idss_ref - SQRT3HALF * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqss_ref;</div>
<div class="line"><span class="lineno">  739</span> </div>
<div class="line"><span class="lineno">  740</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Va_NLC = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;A_NLC * atanf(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;B_NLC * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ia_ref);</div>
<div class="line"><span class="lineno">  741</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vb_NLC = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;A_NLC * atanf(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;B_NLC * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ib_ref);</div>
<div class="line"><span class="lineno">  742</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vc_NLC = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;A_NLC * atanf(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;B_NLC * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ic_ref);</div>
<div class="line"><span class="lineno">  743</span> </div>
<div class="line"><span class="lineno">  744</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Van_ref = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vas_ref + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Voffset + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Va_NLC, -0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc, 0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc);</div>
<div class="line"><span class="lineno">  745</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbn_ref = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbs_ref + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Voffset + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vb_NLC, -0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc, 0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc);</div>
<div class="line"><span class="lineno">  746</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcn_ref = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcs_ref + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Voffset + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vc_NLC, -0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc, 0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc);</div>
<div class="line"><span class="lineno">  747</span> </div>
<div class="line"><span class="lineno">  748</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_A = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Van_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;INV_Vdc + 0.5f, 0.f, 1.f);</div>
<div class="line"><span class="lineno">  749</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_B = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbn_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;INV_Vdc + 0.5f, 0.f, 1.f);</div>
<div class="line"><span class="lineno">  750</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_C = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcn_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;INV_Vdc + 0.5f, 0.f, 1.f);</div>
<div class="line"><span class="lineno">  751</span> </div>
<div class="line"><span class="lineno">  752</span>    <a class="code hl_function" href="#a4b849dca1f135dd860c6f0ce88cc7c13">PwmDutyUpt</a>();</div>
<div class="line"><span class="lineno">  753</span>    <a class="code hl_function" href="#a031511fea69b8fce19a44f86eb1858fe">PwmSwOn</a>();</div>
<div class="line"><span class="lineno">  754</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="flag_8c.html#ac09613eff9a28b2750787c13d7d6fdc9">FLAG</a>.FAULT) PWM_BUF_ON;</div>
<div class="line"><span class="lineno">  755</span>}</div>
<div class="ttc" id="ainv_8c_html_adc9491aaf3043e1e99f084debf0bd167"><div class="ttname"><a href="#adc9491aaf3043e1e99f084debf0bd167">cnt_inj</a></div><div class="ttdeci">int cnt_inj</div><div class="ttdoc">구형파 주입 카운터 (홀짝 토글)</div><div class="ttdef"><b>Definition</b> <a href="inv_8c_source.html#l00057">inv.c:57</a></div></div>
</div><!-- fragment --><div class="dynheader">
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="inv_8c_aedf8f86f640274dface77130a3d50207_cgraph.png" border="0" usemap="#ainv_8c_aedf8f86f640274dface77130a3d50207_cgraph" loading="lazy" alt=""/></div>
<map name="ainv_8c_aedf8f86f640274dface77130a3d50207_cgraph" id="ainv_8c_aedf8f86f640274dface77130a3d50207_cgraph">
<area shape="rect" title="d축 구형파 전압 주입 (파라미터 추정용)" alt="" coords="5,31,200,57"/>
<area shape="rect" href="inv_8c.html#a4b849dca1f135dd860c6f0ce88cc7c13" title="TIM1 CCR 레지스터에 듀티비를 업데이트한다." alt="" coords="248,5,348,32"/>
<area shape="poly" title=" " alt="" coords="200,29,235,27,230,28,201,34"/>
<area shape="rect" href="inv_8c.html#a031511fea69b8fce19a44f86eb1858fe" title="TIM1 PWM 출력을 활성화한다 (3상 상하 암 모두)." alt="" coords="254,56,342,83"/>
<area shape="poly" title=" " alt="" coords="200,54,242,62,236,62,200,59"/>
</map>
</div>
<div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="inv_8c_aedf8f86f640274dface77130a3d50207_icgraph.png" border="0" usemap="#ainv_8c_aedf8f86f640274dface77130a3d50207_icgraph" loading="lazy" alt=""/></div>
<map name="ainv_8c_aedf8f86f640274dface77130a3d50207_icgraph" id="ainv_8c_aedf8f86f640274dface77130a3d50207_icgraph">
<area shape="rect" title="d축 구형파 전압 주입 (파라미터 추정용)" alt="" coords="292,5,486,32"/>
<area shape="rect" href="control_8c.html#afb486c446e28753e3dca5112dfdc8264" title="PMSM 메인 제어 함수 (TIM2 인터럽트에서 100µs 주기로 호출)" alt="" coords="181,5,244,32"/>
<area shape="poly" title=" " alt="" coords="274,19,245,21,245,16,279,19"/>
<area shape="rect" href="stm32g4xx__it_8c.html#a38ad4725462bdc5e86c4ead4f04b9fc2" title="TIM2 글로벌 인터럽트 핸들러 ★ 제어 루프 진입점 ★" alt="" coords="5,5,133,32"/>
<area shape="poly" title=" " alt="" coords="162,19,133,21,133,16,168,18"/>
</map>
</div>

</div>
</div>
<a id="aefbd0b8bc957317d7f22f0db0185683d" name="aefbd0b8bc957317d7f22f0db0185683d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aefbd0b8bc957317d7f22f0db0185683d">&#9670;&#160;</a></span>VoltageOpenLoopControl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void VoltageOpenLoopControl </td>
          <td>(</td>
          <td class="paramtype">struct INVERTER *</td>          <td class="paramname"><span class="paramname"><em>INV</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>전압 개루프 제어 (Voltage Open-Loop Control) </p>
<p>외부에서 직접 설정한 dq 전압 기준(Vdsr_ref_OLC, Vqsr_ref_OLC)을 OLC 각도로 역변환하여 PWM을 출력한다.</p>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname"><a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30" title="인버터 전역 상태/파라미터 구조체">INV</a></td><td>인버터 구조체 포인터 </td></tr>
  </table>
  </dd>
</dl>

<p class="definition"><a class="el" href="inv_8c_source.html">inv.c</a> 파일의 <a class="el" href="inv_8c_source.html#l00627">627</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  628</span>{</div>
<div class="line"><span class="lineno">  629</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_unsat = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_OLC;</div>
<div class="line"><span class="lineno">  630</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_unsat = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_OLC;</div>
<div class="line"><span class="lineno">  631</span> </div>
<div class="line"><span class="lineno">  632</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_OLC = BOUND_PI(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_OLC + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_OLC * RPM2RM * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;PP * Tsamp);</div>
<div class="line"><span class="lineno">  633</span> </div>
<div class="line"><span class="lineno">  634</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="group___control_mode.html#ga5e542439936627687d1a27ac7b6b50c2">Theta_mode</a>) {</div>
<div class="line"><span class="lineno">  635</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar = <a class="code hl_variable" href="speed__observer_8c.html#aaac3af89e1dd9944b6bccef174d4250b">EXT_1</a>.Thetar_EXT_old;</div>
<div class="line"><span class="lineno">  636</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wr     = <a class="code hl_variable" href="speed__observer_8c.html#aaac3af89e1dd9944b6bccef174d4250b">EXT_1</a>.Wr_EXT_f;</div>
<div class="line"><span class="lineno">  637</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  638</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_OLC;</div>
<div class="line"><span class="lineno">  639</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wr     = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_OLC * RPM2RM * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;PP;</div>
<div class="line"><span class="lineno">  640</span>    }</div>
<div class="line"><span class="lineno">  641</span> </div>
<div class="line"><span class="lineno">  642</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idss = (2.f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ia - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ib - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ic) * INV_3;</div>
<div class="line"><span class="lineno">  643</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqss = (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ib - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ic) * INV_SQRT3;</div>
<div class="line"><span class="lineno">  644</span> </div>
<div class="line"><span class="lineno">  645</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_adv    = BOUND_PI(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar + 1.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wr * Tsamp);</div>
<div class="line"><span class="lineno">  646</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;cosThetar     = COS(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar);</div>
<div class="line"><span class="lineno">  647</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;sinThetar     = SIN(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar, <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar);</div>
<div class="line"><span class="lineno">  648</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;cosThetar_adv = COS(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_adv * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_adv);</div>
<div class="line"><span class="lineno">  649</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;sinThetar_adv = SIN(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_adv, <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_adv * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_adv);</div>
<div class="line"><span class="lineno">  650</span> </div>
<div class="line"><span class="lineno">  651</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_unsat, -<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc * INV_SQRT3, <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc * INV_SQRT3);</div>
<div class="line"><span class="lineno">  652</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_unsat, -<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc * INV_SQRT3, <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc * INV_SQRT3);</div>
<div class="line"><span class="lineno">  653</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_aw  = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_unsat - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref;</div>
<div class="line"><span class="lineno">  654</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_aw  = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_unsat - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref;</div>
<div class="line"><span class="lineno">  655</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdss_ref = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;cosThetar_adv - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;sinThetar_adv;</div>
<div class="line"><span class="lineno">  656</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqss_ref = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;sinThetar_adv + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;cosThetar_adv;</div>
<div class="line"><span class="lineno">  657</span> </div>
<div class="line"><span class="lineno">  658</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vas_ref = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdss_ref;</div>
<div class="line"><span class="lineno">  659</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbs_ref = -0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdss_ref + SQRT3HALF * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqss_ref;</div>
<div class="line"><span class="lineno">  660</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcs_ref = -0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdss_ref - SQRT3HALF * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqss_ref;</div>
<div class="line"><span class="lineno">  661</span> </div>
<div class="line"><span class="lineno">  662</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmax = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vas_ref;</div>
<div class="line"><span class="lineno">  663</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmax &lt; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbs_ref) <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmax = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbs_ref;</div>
<div class="line"><span class="lineno">  664</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmax &lt; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcs_ref) <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmax = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcs_ref;</div>
<div class="line"><span class="lineno">  665</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmin = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vas_ref;</div>
<div class="line"><span class="lineno">  666</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmin &gt; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbs_ref) <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmin = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbs_ref;</div>
<div class="line"><span class="lineno">  667</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmin &gt; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcs_ref) <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmin = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcs_ref;</div>
<div class="line"><span class="lineno">  668</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Voffset = -0.5f * (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmax + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmin);</div>
<div class="line"><span class="lineno">  669</span> </div>
<div class="line"><span class="lineno">  670</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Van_ref = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vas_ref + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Voffset, -0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc, 0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc);</div>
<div class="line"><span class="lineno">  671</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbn_ref = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbs_ref + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Voffset, -0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc, 0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc);</div>
<div class="line"><span class="lineno">  672</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcn_ref = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcs_ref + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Voffset, -0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc, 0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc);</div>
<div class="line"><span class="lineno">  673</span> </div>
<div class="line"><span class="lineno">  674</span>    <a class="code hl_variable" href="group___voltage_ref.html#ga30c95cfd601124d7bb6a4535bdeb1f72">Van</a> = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Van_ref; <a class="code hl_variable" href="group___voltage_ref.html#ga2f2a0c510c5b72110e5e3835c1c62555">Vbn</a> = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbn_ref; <a class="code hl_variable" href="group___voltage_ref.html#ga99d72ed4a63ffab24762fc939a2b9c7d">Vcn</a> = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcn_ref;</div>
<div class="line"><span class="lineno">  675</span> </div>
<div class="line"><span class="lineno">  676</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_A = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Van_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;INV_Vdc + 0.5f, 0.f, 1.f);</div>
<div class="line"><span class="lineno">  677</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_B = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbn_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;INV_Vdc + 0.5f, 0.f, 1.f);</div>
<div class="line"><span class="lineno">  678</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_C = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcn_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;INV_Vdc + 0.5f, 0.f, 1.f);</div>
<div class="line"><span class="lineno">  679</span> </div>
<div class="line"><span class="lineno">  680</span>    <a class="code hl_function" href="#a031511fea69b8fce19a44f86eb1858fe">PwmSwOn</a>();</div>
<div class="line"><span class="lineno">  681</span>    <a class="code hl_function" href="#a4b849dca1f135dd860c6f0ce88cc7c13">PwmDutyUpt</a>();</div>
<div class="line"><span class="lineno">  682</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="flag_8c.html#ac09613eff9a28b2750787c13d7d6fdc9">FLAG</a>.FAULT) PWM_BUF_ON;</div>
<div class="line"><span class="lineno">  683</span>}</div>
<div class="ttc" id="aspeed__observer_8c_html_aaac3af89e1dd9944b6bccef174d4250b"><div class="ttname"><a href="speed__observer_8c.html#aaac3af89e1dd9944b6bccef174d4250b">EXT_1</a></div><div class="ttdeci">struct EXT_Sensorless EXT_1</div><div class="ttdoc">확장 센서리스 옵저버 전역 구조체</div><div class="ttdef"><b>Definition</b> <a href="speed__observer_8c_source.html#l00032">speed_observer.c:32</a></div></div>
</div><!-- fragment --><div class="dynheader">
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="inv_8c_aefbd0b8bc957317d7f22f0db0185683d_cgraph.png" border="0" usemap="#ainv_8c_aefbd0b8bc957317d7f22f0db0185683d_cgraph" loading="lazy" alt=""/></div>
<map name="ainv_8c_aefbd0b8bc957317d7f22f0db0185683d_cgraph" id="ainv_8c_aefbd0b8bc957317d7f22f0db0185683d_cgraph">
<area shape="rect" title="전압 개루프 제어 (Voltage Open&#45;Loop Control)" alt="" coords="5,31,171,57"/>
<area shape="rect" href="inv_8c.html#a4b849dca1f135dd860c6f0ce88cc7c13" title="TIM1 CCR 레지스터에 듀티비를 업데이트한다." alt="" coords="219,5,319,32"/>
<area shape="poly" title=" " alt="" coords="171,30,206,27,201,28,172,35"/>
<area shape="rect" href="inv_8c.html#a031511fea69b8fce19a44f86eb1858fe" title="TIM1 PWM 출력을 활성화한다 (3상 상하 암 모두)." alt="" coords="225,56,312,83"/>
<area shape="poly" title=" " alt="" coords="171,53,212,61,207,61,171,58"/>
</map>
</div>
<div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="inv_8c_aefbd0b8bc957317d7f22f0db0185683d_icgraph.png" border="0" usemap="#ainv_8c_aefbd0b8bc957317d7f22f0db0185683d_icgraph" loading="lazy" alt=""/></div>
<map name="ainv_8c_aefbd0b8bc957317d7f22f0db0185683d_icgraph" id="ainv_8c_aefbd0b8bc957317d7f22f0db0185683d_icgraph">
<area shape="rect" title="전압 개루프 제어 (Voltage Open&#45;Loop Control)" alt="" coords="292,5,457,32"/>
<area shape="rect" href="control_8c.html#afb486c446e28753e3dca5112dfdc8264" title="PMSM 메인 제어 함수 (TIM2 인터럽트에서 100µs 주기로 호출)" alt="" coords="181,5,244,32"/>
<area shape="poly" title=" " alt="" coords="274,19,244,21,244,16,279,19"/>
<area shape="rect" href="stm32g4xx__it_8c.html#a38ad4725462bdc5e86c4ead4f04b9fc2" title="TIM2 글로벌 인터럽트 핸들러 ★ 제어 루프 진입점 ★" alt="" coords="5,5,133,32"/>
<area shape="poly" title=" " alt="" coords="162,19,133,21,133,16,168,18"/>
</map>
</div>

</div>
</div>
<a id="a01248186cec9f4dadc54e4c94be940cf" name="a01248186cec9f4dadc54e4c94be940cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a01248186cec9f4dadc54e4c94be940cf">&#9670;&#160;</a></span>Vref_GenControl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Vref_GenControl </td>
          <td>(</td>
          <td class="paramtype">struct INVERTER *</td>          <td class="paramname"><span class="paramname"><em>INV</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>전압 기준 생성 제어 (전압 피드포워드 방식) </p>
<p>Theta_mode에 따라 두 가지 동작을 수행한다:</p><ul>
<li>mode=1 (OLC): OLC 기준으로 모델 기반 피드포워드 전압 생성</li>
<li>mode=0 (Hall): Hall PLL 각도 + 속도 제어 토크 기준으로 전압 생성</li>
</ul>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname"><a class="el" href="#a5b799dff3aee9e48ae67cfe1f9075e30" title="인버터 전역 상태/파라미터 구조체">INV</a></td><td>인버터 구조체 포인터 </td></tr>
  </table>
  </dd>
</dl>

<p class="definition"><a class="el" href="inv_8c_source.html">inv.c</a> 파일의 <a class="el" href="inv_8c_source.html#l00534">534</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  535</span>{</div>
<div class="line"><span class="lineno">  536</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="group___control_mode.html#ga5e542439936627687d1a27ac7b6b50c2">Theta_mode</a> == 1) {</div>
<div class="line"><span class="lineno">  537</span>        <span class="comment">/* OLC 각도 + 모델 기반 피드포워드 전압 */</span></div>
<div class="line"><span class="lineno">  538</span>        <span class="keywordflow">if</span>      (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref_set_OLC &gt; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref_OLC + Tsamp * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_slope_OLC)</div>
<div class="line"><span class="lineno">  539</span>                 <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref_OLC += Tsamp * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_slope_OLC;</div>
<div class="line"><span class="lineno">  540</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref_set_OLC &lt; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref_OLC - Tsamp * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_slope_OLC)</div>
<div class="line"><span class="lineno">  541</span>                 <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref_OLC -= Tsamp * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_slope_OLC;</div>
<div class="line"><span class="lineno">  542</span>        <span class="keywordflow">else</span>     <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref_OLC  = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref_set_OLC;</div>
<div class="line"><span class="lineno">  543</span> </div>
<div class="line"><span class="lineno">  544</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref_OLC;</div>
<div class="line"><span class="lineno">  545</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_ref = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_ref_OLC;</div>
<div class="line"><span class="lineno">  546</span> </div>
<div class="line"><span class="lineno">  547</span>        <span class="keywordflow">if</span>      (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_set_OLC &gt; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_OLC + Tsamp * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_slope_OLC)</div>
<div class="line"><span class="lineno">  548</span>                 <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_OLC += Tsamp * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_slope_OLC;</div>
<div class="line"><span class="lineno">  549</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_set_OLC &lt; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_OLC - Tsamp * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_slope_OLC)</div>
<div class="line"><span class="lineno">  550</span>                 <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_OLC -= Tsamp * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_slope_OLC;</div>
<div class="line"><span class="lineno">  551</span>        <span class="keywordflow">else</span>     <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_OLC  = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_set_OLC;</div>
<div class="line"><span class="lineno">  552</span> </div>
<div class="line"><span class="lineno">  553</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wr_ref_OLC = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrpm_ref_OLC * RPM2RM * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;PP;</div>
<div class="line"><span class="lineno">  554</span> </div>
<div class="line"><span class="lineno">  555</span>        <span class="comment">/* 정상 상태 전압 모델: Vd = Rs×Id - Wr×Lq×Iq, Vq = Rs×Iq + Wr×(Ld×Id + λf) */</span></div>
<div class="line"><span class="lineno">  556</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_OLC = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Rs * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref_OLC - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wr_ref_OLC * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Lq * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_ref_OLC;</div>
<div class="line"><span class="lineno">  557</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_OLC = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Rs * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_ref_OLC + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wr_ref_OLC * (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ld * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref_OLC + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Lamf);</div>
<div class="line"><span class="lineno">  558</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_unsat = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_OLC;</div>
<div class="line"><span class="lineno">  559</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_unsat = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_OLC;</div>
<div class="line"><span class="lineno">  560</span> </div>
<div class="line"><span class="lineno">  561</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_OLC = BOUND_PI(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_OLC + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wr_ref_OLC * Tsamp);</div>
<div class="line"><span class="lineno">  562</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar     = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_OLC;</div>
<div class="line"><span class="lineno">  563</span>    }</div>
<div class="line"><span class="lineno">  564</span>    <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  565</span>        <span class="comment">/* Hall PLL 각도 + 속도 제어 토크 → Iq 기준 전환 */</span></div>
<div class="line"><span class="lineno">  566</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_ref_unsat = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Te_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;INV_Kt;</div>
<div class="line"><span class="lineno">  567</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_ref = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_ref_unsat, -1.3f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Is_rated, 1.3f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Is_rated);</div>
<div class="line"><span class="lineno">  568</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref = 0;</div>
<div class="line"><span class="lineno">  569</span> </div>
<div class="line"><span class="lineno">  570</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Rs * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrm_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;PP * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Lq * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_ref;</div>
<div class="line"><span class="lineno">  571</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Rs * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Iqsr_ref + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wrm_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;PP * (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Ld * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Idsr_ref + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Lamf);</div>
<div class="line"><span class="lineno">  572</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_unsat = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref;</div>
<div class="line"><span class="lineno">  573</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_unsat = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref;</div>
<div class="line"><span class="lineno">  574</span> </div>
<div class="line"><span class="lineno">  575</span>        <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_est_Hall;</div>
<div class="line"><span class="lineno">  576</span>    }</div>
<div class="line"><span class="lineno">  577</span> </div>
<div class="line"><span class="lineno">  578</span>    <span class="comment">/* 이하 역변환 및 PWM 출력 (CurrentControl과 동일 구조) */</span></div>
<div class="line"><span class="lineno">  579</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_adv    = BOUND_PI(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar + 1.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Wr * Tsamp);</div>
<div class="line"><span class="lineno">  580</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;cosThetar     = COS(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar);</div>
<div class="line"><span class="lineno">  581</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;sinThetar     = SIN(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar, <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar);</div>
<div class="line"><span class="lineno">  582</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;cosThetar_adv = COS(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_adv * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_adv);</div>
<div class="line"><span class="lineno">  583</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;sinThetar_adv = SIN(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_adv, <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_adv * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Thetar_adv);</div>
<div class="line"><span class="lineno">  584</span> </div>
<div class="line"><span class="lineno">  585</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_unsat, -<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc * INV_SQRT3, <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc * INV_SQRT3);</div>
<div class="line"><span class="lineno">  586</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_unsat, -<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc * INV_SQRT3, <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc * INV_SQRT3);</div>
<div class="line"><span class="lineno">  587</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_aw  = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref_unsat - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref;</div>
<div class="line"><span class="lineno">  588</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_aw  = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref_unsat - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref;</div>
<div class="line"><span class="lineno">  589</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdss_ref = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;cosThetar_adv - <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;sinThetar_adv;</div>
<div class="line"><span class="lineno">  590</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqss_ref = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdsr_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;sinThetar_adv + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqsr_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;cosThetar_adv;</div>
<div class="line"><span class="lineno">  591</span> </div>
<div class="line"><span class="lineno">  592</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vas_ref = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdss_ref;</div>
<div class="line"><span class="lineno">  593</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbs_ref = -0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdss_ref + SQRT3HALF * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqss_ref;</div>
<div class="line"><span class="lineno">  594</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcs_ref = -0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdss_ref - SQRT3HALF * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vqss_ref;</div>
<div class="line"><span class="lineno">  595</span> </div>
<div class="line"><span class="lineno">  596</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmax = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vas_ref;</div>
<div class="line"><span class="lineno">  597</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmax &lt; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbs_ref) <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmax = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbs_ref;</div>
<div class="line"><span class="lineno">  598</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmax &lt; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcs_ref) <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmax = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcs_ref;</div>
<div class="line"><span class="lineno">  599</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmin = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vas_ref;</div>
<div class="line"><span class="lineno">  600</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmin &gt; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbs_ref) <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmin = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbs_ref;</div>
<div class="line"><span class="lineno">  601</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmin &gt; <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcs_ref) <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmin = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcs_ref;</div>
<div class="line"><span class="lineno">  602</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Voffset = -0.5f * (<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmax + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vmin);</div>
<div class="line"><span class="lineno">  603</span> </div>
<div class="line"><span class="lineno">  604</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Van_ref = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vas_ref + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Voffset, -0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc, 0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc);</div>
<div class="line"><span class="lineno">  605</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbn_ref = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbs_ref + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Voffset, -0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc, 0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc);</div>
<div class="line"><span class="lineno">  606</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcn_ref = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcs_ref + <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Voffset, -0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc, 0.5f * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vdc);</div>
<div class="line"><span class="lineno">  607</span> </div>
<div class="line"><span class="lineno">  608</span>    <a class="code hl_variable" href="group___voltage_ref.html#ga30c95cfd601124d7bb6a4535bdeb1f72">Van</a> = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Van_ref; <a class="code hl_variable" href="group___voltage_ref.html#ga2f2a0c510c5b72110e5e3835c1c62555">Vbn</a> = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbn_ref; <a class="code hl_variable" href="group___voltage_ref.html#ga99d72ed4a63ffab24762fc939a2b9c7d">Vcn</a> = <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcn_ref;</div>
<div class="line"><span class="lineno">  609</span> </div>
<div class="line"><span class="lineno">  610</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_A = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Van_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;INV_Vdc + 0.5f, 0.f, 1.f);</div>
<div class="line"><span class="lineno">  611</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_B = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vbn_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;INV_Vdc + 0.5f, 0.f, 1.f);</div>
<div class="line"><span class="lineno">  612</span>    <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Duty_C = LIMIT(<a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;Vcn_ref * <a class="code hl_variable" href="#a5b799dff3aee9e48ae67cfe1f9075e30">INV</a>-&gt;INV_Vdc + 0.5f, 0.f, 1.f);</div>
<div class="line"><span class="lineno">  613</span> </div>
<div class="line"><span class="lineno">  614</span>    <a class="code hl_function" href="#a031511fea69b8fce19a44f86eb1858fe">PwmSwOn</a>();</div>
<div class="line"><span class="lineno">  615</span>    <a class="code hl_function" href="#a4b849dca1f135dd860c6f0ce88cc7c13">PwmDutyUpt</a>();</div>
<div class="line"><span class="lineno">  616</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="flag_8c.html#ac09613eff9a28b2750787c13d7d6fdc9">FLAG</a>.FAULT) PWM_BUF_ON;</div>
<div class="line"><span class="lineno">  617</span>}</div>
</div><!-- fragment --><div class="dynheader">
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="inv_8c_a01248186cec9f4dadc54e4c94be940cf_cgraph.png" border="0" usemap="#ainv_8c_a01248186cec9f4dadc54e4c94be940cf_cgraph" loading="lazy" alt=""/></div>
<map name="ainv_8c_a01248186cec9f4dadc54e4c94be940cf_cgraph" id="ainv_8c_a01248186cec9f4dadc54e4c94be940cf_cgraph">
<area shape="rect" title="전압 기준 생성 제어 (전압 피드포워드 방식)" alt="" coords="5,31,123,57"/>
<area shape="rect" href="inv_8c.html#a4b849dca1f135dd860c6f0ce88cc7c13" title="TIM1 CCR 레지스터에 듀티비를 업데이트한다." alt="" coords="171,5,271,32"/>
<area shape="poly" title=" " alt="" coords="123,32,158,28,153,30,124,37"/>
<area shape="rect" href="inv_8c.html#a031511fea69b8fce19a44f86eb1858fe" title="TIM1 PWM 출력을 활성화한다 (3상 상하 암 모두)." alt="" coords="177,56,264,83"/>
<area shape="poly" title=" " alt="" coords="123,51,164,60,159,60,123,56"/>
</map>
</div>
<div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="inv_8c_a01248186cec9f4dadc54e4c94be940cf_icgraph.png" border="0" usemap="#ainv_8c_a01248186cec9f4dadc54e4c94be940cf_icgraph" loading="lazy" alt=""/></div>
<map name="ainv_8c_a01248186cec9f4dadc54e4c94be940cf_icgraph" id="ainv_8c_a01248186cec9f4dadc54e4c94be940cf_icgraph">
<area shape="rect" title="전압 기준 생성 제어 (전압 피드포워드 방식)" alt="" coords="292,5,409,32"/>
<area shape="rect" href="control_8c.html#afb486c446e28753e3dca5112dfdc8264" title="PMSM 메인 제어 함수 (TIM2 인터럽트에서 100µs 주기로 호출)" alt="" coords="181,5,244,32"/>
<area shape="poly" title=" " alt="" coords="274,19,245,21,244,16,279,19"/>
<area shape="rect" href="stm32g4xx__it_8c.html#a38ad4725462bdc5e86c4ead4f04b9fc2" title="TIM2 글로벌 인터럽트 핸들러 ★ 제어 루프 진입점 ★" alt="" coords="5,5,133,32"/>
<area shape="poly" title=" " alt="" coords="162,19,133,21,133,16,168,18"/>
</map>
</div>

</div>
</div>
<a name="doc-var-members" id="doc-var-members"></a><h2 id="header-doc-var-members" class="groupheader">변수 문서화</h2>
<a id="adc9491aaf3043e1e99f084debf0bd167" name="adc9491aaf3043e1e99f084debf0bd167"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc9491aaf3043e1e99f084debf0bd167">&#9670;&#160;</a></span>cnt_inj</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cnt_inj = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>구형파 주입 카운터 (홀짝 토글) </p>

<p class="definition"><a class="el" href="inv_8c_source.html">inv.c</a> 파일의 <a class="el" href="inv_8c_source.html#l00057">57</a> 번째 라인에서 정의되었습니다.</p>

</div>
</div>
<a id="ab5e71ba0276929fe061bacdcc22c3335" name="ab5e71ba0276929fe061bacdcc22c3335"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5e71ba0276929fe061bacdcc22c3335">&#9670;&#160;</a></span>dutyCycle</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float dutyCycle</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel extern">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>RC 수신기 입력 듀티 사이클 값 [0.0, 1.0] </p>
<p>TIM15 입력 캡처로부터 계산된 PWM 듀티비. <a class="el" href="control_8c.html#afb486c446e28753e3dca5112dfdc8264" title="PMSM 메인 제어 함수 (TIM2 인터럽트에서 100µs 주기로 호출)">Control()</a> 함수 내에서 속도 또는 토크 기준으로 변환된다. </p>

<p class="definition"><a class="el" href="main_8c_source.html">main.c</a> 파일의 <a class="el" href="main_8c_source.html#l00056">56</a> 번째 라인에서 정의되었습니다.</p>

</div>
</div>
<a id="aac3d2c59ee0e3bbae1b99529a154eb62" name="aac3d2c59ee0e3bbae1b99529a154eb62"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac3d2c59ee0e3bbae1b99529a154eb62">&#9670;&#160;</a></span>htim3</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">TIM_HandleTypeDef htim3</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel extern">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a5b799dff3aee9e48ae67cfe1f9075e30" name="a5b799dff3aee9e48ae67cfe1f9075e30"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5b799dff3aee9e48ae67cfe1f9075e30">&#9670;&#160;</a></span>INV</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct INVERTER INV</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>인버터 전역 상태/파라미터 구조체 </p>

<p class="definition"><a class="el" href="inv_8c_source.html">inv.c</a> 파일의 <a class="el" href="inv_8c_source.html#l00053">53</a> 번째 라인에서 정의되었습니다.</p>

</div>
</div>
<a id="a90e45c5ed8c3f0ed09963d378e1ad75a" name="a90e45c5ed8c3f0ed09963d378e1ad75a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a90e45c5ed8c3f0ed09963d378e1ad75a">&#9670;&#160;</a></span>Mode_align</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Mode_align = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>정렬 상태 머신 단계 (0~3) </p>

<p class="definition"><a class="el" href="inv_8c_source.html">inv.c</a> 파일의 <a class="el" href="inv_8c_source.html#l00055">55</a> 번째 라인에서 정의되었습니다.</p>

</div>
</div>
<a id="ad09af8d36a15d8f6f38d126a90b36862" name="ad09af8d36a15d8f6f38d126a90b36862"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad09af8d36a15d8f6f38d126a90b36862">&#9670;&#160;</a></span>Time_align</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float Time_align = 0.</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>정렬 경과 시간 [s] </p>

<p class="definition"><a class="el" href="inv_8c_source.html">inv.c</a> 파일의 <a class="el" href="inv_8c_source.html#l00056">56</a> 번째 라인에서 정의되었습니다.</p>

</div>
</div>
<a id="afcd0f0ee99ff421a667c81624818d6ae" name="afcd0f0ee99ff421a667c81624818d6ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afcd0f0ee99ff421a667c81624818d6ae">&#9670;&#160;</a></span>W_LPF_set</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float W_LPF_set = 50.f</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>속도 LPF 차단 주파수 설정값 [Hz] </p>

<p class="definition"><a class="el" href="inv_8c_source.html">inv.c</a> 파일의 <a class="el" href="inv_8c_source.html#l00058">58</a> 번째 라인에서 정의되었습니다.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_4e8d938e9ddb5a617c200d5739d1f41a.html">doxygen</a></li><li class="navelem"><a href="dir_985d89a533ae4c988ecd0cc1b0a10377.html">RC_DRIVER</a></li><li class="navelem"><a href="inv_8c.html">inv.c</a></li>
    <li class="footer">다음에 의해 생성됨 :  <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.16.1 </li>
  </ul>
</div>
</body>
</html>
